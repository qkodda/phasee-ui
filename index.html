
<!doctype html>
<html lang="en" data-theme="day">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Phasee ¬∑ Plan ahead. Stay ahead.</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
.campaign-shell{ max-width:100%; }
.camp-table{
  overflow-x:hidden;          /* no horizontal scroll */
  position:relative;          /* ensure CSS vars resolve consistently */
}



/* ===================== THEME + TOKENS ===================== */
:root{
  --font: 14.5px/1.55 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  --radius-lg:16px; --radius:12px; --radius-sm:9px;
  --shadow-1: 0 6px 18px rgba(20,25,38,.06);
  --shadow-2: 0 14px 30px rgba(20,25,38,.10);

  /* brand / accents */
  --accent:#7A70F5;             /* primary lavender */
  --accent-2:#FF8A3D;           /* vibrant orange for pop/hover */
  --plus:#49D07E;               /* friendly green plus */
  --plus-glow: rgba(73,208,126,.22);

  /* day */
  --bg: #F7F8FC;
  --panel: #ffffff;
  --panel-2: #FAFBFF;
  --ring:#E7EAF5;
  --ink:#0f172a;
  --muted:#6b7280;
  --chip:#EEF0FF; --chip-b:#DADFFF;
}
[data-theme="night"]{
  --bg: #0E1220;
  --panel:#141A2B;
  --panel-2:#11182A;
  --ink:#E7ECF8;
  --muted:#9AA6C0;
  --chip:#1A2140; --chip-b:#2A335C;
}
:root{
  /* overlay & ink for future-month cards (day theme) */
  --nm-overlay: rgba(15,23,42,.28);
  --nm-ink: rgba(15,23,42,.78);
}
[data-theme="night"]{
  /* slightly stronger on dark theme */
  --nm-overlay: rgba(0,0,0,.33);
  --nm-ink: rgba(255,255,255,.82);
}

:root{
  /* ...existing tokens... */
  --camp-cols:
    minmax(150px, var(--c-name, 1.2fr))
    minmax(140px, var(--c-objective, 1.1fr))
    minmax(210px, var(--c-range, 1.15fr))
    minmax(110px, var(--c-posts, 0.9fr))
    minmax(120px, var(--c-status, 0.95fr))
    minmax(180px, var(--c-platforms, 1.1fr))
    minmax(130px, var(--c-tone, 0.95fr))
    minmax(180px, var(--c-notes, 1.05fr));
}

/* ===================== LAYOUT SHELL ===================== */
*{box-sizing:border-box}
html,body{margin:0;height:100%}
body{font:var(--font); color:var(--ink); background:
  radial-gradient(1400px 700px at 20% -10%, #F1F3FF 0%, var(--bg) 38%, var(--bg) 100%);}

a{color:inherit; text-decoration:none}
button{font:inherit}

.app{
  display:grid; grid-template-columns: 220px 1fr; min-height:100dvh;
}

/* ===================== SIDEBAR ===================== */
.side{
  position:sticky; top:0; height:100dvh; padding:18px 12px 16px;
  background:linear-gradient(180deg, var(--panel), var(--panel-2));
  border-right:1px solid var(--ring);
  display:flex; flex-direction:column; gap:10px; z-index:5;
}
.brand{display:flex; align-items:center; gap:10px; padding:6px 8px}
.logo{width:26px;height:26px;border-radius:8px;
  background:linear-gradient(135deg,var(--accent),color-mix(in oklab,var(--accent-2) 65%, #fff 35%));
  box-shadow:0 8px 18px color-mix(in oklab, var(--accent) 42%, transparent);
}
.brandname{font-weight:900; font-size:22px}

.nav{display:grid; gap:6px; margin-top:8px}
.nav a{
  display:flex; align-items:center; gap:10px;
  padding:10px; border-radius:12px; font-weight:800; border:1px solid transparent;
}
.nav a[data-active="true"], .nav a:hover{
  background:var(--panel-2); border-color:var(--ring)
}

/* Settings block at bottom */
.side .foot{margin-top:auto; display:grid; gap:8px; padding:8px}
.settings-link{
  font-weight:800; cursor:pointer; width:max-content;
  padding:8px 10px; border-radius:12px;
}
.settings-link:hover{background:var(--panel-2); border:1px solid var(--ring)}
.plan-wrap{display:grid; gap:6px; margin-top:2px}
.plan-name{font-size:12px; color:var(--muted); text-align:center}
.upgrade{
  justify-self:center;
  border:1px solid transparent;
  color:#fff;
  font-weight:900;
  background:linear-gradient(135deg, var(--accent-2), color-mix(in oklab, var(--accent-2) 85%, #ffd7bf 15%));
  padding:8px 12px;
  border-radius:12px;
  box-shadow:0 10px 20px rgba(255,138,61,.18);
  cursor:pointer;                /* NEW: pointer */
  transition:transform .08s ease, box-shadow .15s ease, filter .12s ease;
}
.upgrade:hover{ filter:brightness(1.06); box-shadow:0 12px 22px rgba(255,138,61,.22); }
.upgrade:active{ transform:translateY(1px); box-shadow:0 6px 14px rgba(255,138,61,.18); }
.upgrade:focus-visible{
  outline:2px solid color-mix(in oklab,var(--accent-2) 65%, #fff 35%);
  outline-offset:2px;
}


/* ===================== TOP BAR ===================== */
.main{display:grid; grid-template-rows:62px 1fr}
.top{
  background:linear-gradient(180deg, var(--panel), color-mix(in srgb, var(--panel-2) 60%, var(--panel) 40%));
  border-bottom:1px solid var(--ring); padding:0 16px;
  display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:4;
}/* add this */
.top { justify-content: flex-start; }   /* keep default layout */
.controls { margin-left: auto; }        /* pushes the controls to the right */

.monthbar{display:flex; align-items:center; gap:8px}
.monthbtn{appearance:none; border:1px solid var(--ring); background:var(--panel); border-radius:12px; padding:6px 10px; font-weight:800; cursor:pointer}
.monthlabel{font-weight:900; font-size:18px}

.controls{display:flex; align-items:center; gap:10px; position:relative}
.iconbtn{appearance:none; border:1px solid var(--ring); background:var(--panel); border-radius:12px; padding:6px 10px; cursor:pointer; font-weight:800}

/* View-by dropdown */
.dropdown{
  position:absolute; right:0; top:40px; min-width:240px;
  background:var(--panel); border:1px solid var(--ring); border-radius:12px;
  box-shadow:var(--shadow-2); padding:10px; display:none; z-index:10;
}
.dropdown.open{display:block}
.drop-row{display:flex; align-items:center; gap:8px; padding:6px 4px; border-radius:8px}
.drop-row:hover{background:var(--panel-2)}
.pill{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; font-weight:900; border-radius:999px; border:1px solid var(--ring)}
.pill .dot{width:8px;height:8px;border-radius:50%}

/* ===================== CALENDAR ===================== */
.page{display:none}
.page.active{display:block}
.wrap{padding:16px}

/* page fade */
.page{ display:none; opacity:0; transition:opacity .18s ease;}
.page.active{ display:block; }
.page.active.entering{ opacity:1; }


.calendar{background:var(--panel); border:1px solid var(--ring); border-radius:var(--radius-lg); box-shadow:var(--shadow-2); padding:10px}
/* Let the calendar body scroll so sticky header doesn't hide dates */
.calendar { 
  max-height: calc(100dvh - 140px);
  overflow-y: auto;
}
/* Calendar header: [ prev ] [ Month label ] [ next  üëÅ ] */
.cal-header{
  display: grid;
  grid-template-columns: 1fr auto 1fr; /* left | center | right */
  align-items: center;
  gap: 10px;
  padding: 12px 0 14px;
  font-weight: 900;
  font-size: 18px;
  border-bottom: 1px solid var(--ring);
  margin-bottom: 8px;
}
/* Calendar header: center cluster for arrows+month, eye on far right */
.cal-header{
  display:flex;
  align-items:center;
  justify-content:center;     /* centers the middle cluster */
  gap:10px;
  padding:12px 0 14px;
  font-weight:900;
  font-size:18px;
  border-bottom:1px solid var(--ring);
  margin-bottom:8px;
  position:relative;
}

.cal-mid{
  display:flex;
  align-items:center;
  gap:10px;                   /* arrows hug the month */
}

.cal-right{
  margin-left:auto;           /* pushes eye to the far right */
  display:flex;
  align-items:center;
  gap:8px;
  position:relative;
}

.cal-header .monthbtn,
.cal-header .iconbtn{
  appearance:none;
  border:1px solid var(--ring);
  background:var(--panel);
  border-radius:12px;
  padding:6px 10px;
  font-weight:800;
  cursor:pointer;
}

/* anchor the dropdown to the eye button */
.cal-right .dropdown{ right:0; top:40px; }

.cal-left  { justify-self: start; }
.cal-center{ justify-self: center; }
.cal-right { justify-self: end; display:flex; align-items:center; gap:8px; position:relative; }

.cal-header .monthbtn{
  appearance:none; border:1px solid var(--ring); background:var(--panel);
  border-radius:12px; padding:6px 10px; font-weight:800; cursor:pointer;
}
.cal-header .iconbtn{
  appearance:none; border:1px solid var(--ring); background:var(--panel);
  border-radius:12px; padding:6px 10px; font-weight:800; cursor:pointer;
}

/* anchor the dropdown to the right cluster */
.cal-right .dropdown{ right:0; top:40px; }


.weeks{display:grid; grid-template-columns:repeat(7,1fr); gap:6px; padding:0 6px 4px; color:#8791a7; font-weight:900; font-size:11px}
.grid{display:grid; grid-template-columns:repeat(7,1fr); gap:6px}
/* Glass panel look for every day cell */
.day{
  border-radius:14px;
  padding:10px; min-height:110px;
  display:grid; grid-template-rows:auto 1fr; gap:6px; position:relative;
  /* frosted glass */
  background: rgba(255,255,255,0.55);
  border: 1px solid rgba(255,255,255,0.25);
  backdrop-filter: blur(14px) saturate(120%);
  -webkit-backdrop-filter: blur(14px) saturate(120%);
  /* soft shadow / fade */
  box-shadow: 0 8px 18px rgba(15,23,42,.12);
  transition: transform .12s ease, box-shadow .18s ease, border-color .12s ease;
  scroll-margin-top:72px;
}
[data-theme="night"] .day{
  background: rgba(20,26,43,0.55);
  border-color: rgba(255,255,255,0.08);
}

.day:hover{
  transform: translateY(-2px);
  box-shadow: 0 14px 28px rgba(15,23,42,.18);
  border-color: color-mix(in oklab, var(--accent-2) 30%, var(--ring));
}

.day.selected{outline:2px solid color-mix(in oklab, var(--accent-2) 32%, transparent); outline-offset:2px}
.dhead{display:flex; align-items:center; justify-content:space-between}
.dnum{font-weight:900; font-size:11px}
.plus{
  width:26px; height:26px; display:grid; place-items:center; border-radius:9px; border:0; cursor:pointer;
  color:#03522A; font-weight:900; font-size:16px; line-height:0;
  background: radial-gradient(14px 14px at 50% 50%, #9CF4C5 0%, var(--plus) 65%, var(--plus) 100%);
  box-shadow: 0 0 0 6px var(--plus-glow);
  opacity: 0.55;                 /* more transparent */
  transition: transform .05s ease, opacity .2s ease;
}
.plus:hover{
  opacity: 0.9;                  /* brighter on hover */
}

.plus:active{transform:translateY(.4px)}
.empty{opacity:.65; color:#97a0b3; font-size:11px}
/* Only the little cards inside calendar days should be flex */
.day .card{
  display:flex; align-items:center; gap:6px; padding:6px 8px;
  border-radius:10px; border:1px solid rgba(0,0,0,.05);
  box-shadow:0 6px 14px rgba(15,23,42,.07);
}
/* Distinct colors for previous/next months (keep text readable) */
.day.prev-month{
  background: rgba(255, 116, 116, 0.10);
  border-color: color-mix(in oklab, #ff7474 35%, var(--ring));
}
/* Days that spill into the next month (darker to distinguish) */
/* ---------- Sleek darker look for next-month days ---------- */
:root{
  /* day theme tint */
  --next-bg: color-mix(in oklab, var(--panel-2) 70%, #0f172a 30%);
  --next-bd: color-mix(in oklab, var(--ring) 70%, #0f172a 24%);
  --next-ink: color-mix(in oklab, var(--ink) 88%, #0f172a 12%);
}
[data-theme="night"]{
  /* night theme tint (slightly brighter vs panel for contrast) */
  --next-bg: color-mix(in oklab, var(--panel) 88%, #000 12%);
  --next-bd: color-mix(in oklab, var(--ring) 70%, #000 18%);
  --next-ink: color-mix(in oklab, var(--ink) 92%, #000 8%);
}

/* Base state */
/* Darker translucent glass for next-month days */
/* Darker translucent glass for next-month days */
/* Smooth transparent ‚Äúfuture month‚Äù look (keeps glass, adds a dim fade) */
.day.next-month{
  position: relative;             /* needed for the overlay */
  color: var(--nm-ink);
  border-color: rgba(255,255,255,.18);
}

/* subtle glassy overlay + bottom fade, like the screenshot */
.day.next-month::after{
  content:"";
  position:absolute; inset:0;
  border-radius:inherit;
  pointer-events:none;
  background:
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)) , /* glass sheen */
    radial-gradient(120% 70% at 50% 10%, transparent 45%, var(--nm-overlay) 100%);
  box-shadow:
    inset 0 -56px 90px var(--nm-overlay),         /* bottom fade */
    inset 0 0 0 1px rgba(255,255,255,.08);        /* subtle inner ring */
}
/* === OVERRIDE: make future-month days use the same frosted glass, no gray overlay === */
/* === Modern translucent-glass for next-month (proceeding) days === */
/* === Modern translucent-glass for next-month (proceeding) days === */
.day.next-month{
  /* light theme glass */
  --nm-bg: rgba(255,255,255,.35);
  --nm-bd: rgba(255,255,255,.22);

  background: var(--nm-bg);
  border: 1px solid var(--nm-bd);
  backdrop-filter: blur(16px) saturate(110%);
  -webkit-backdrop-filter: blur(16px) saturate(110%);
  box-shadow:
    0 8px 18px rgba(15,23,42,.10),
    inset 0 1px 0 rgba(255,255,255,.25); /* subtle inner sheen */
  color: color-mix(in oklab, var(--ink) 85%, transparent);
}

/* night theme variant */
[data-theme="night"] .day.next-month{
  --nm-bg: rgba(20,26,43,.35);
  --nm-bd: rgba(255,255,255,.10);

  background: var(--nm-bg);
  border-color: var(--nm-bd);
  color: color-mix(in oklab, var(--ink) 92%, transparent);
}

/* calm the chrome inside those cells */
.day.next-month .dnum{ opacity:.85; }
.day.next-month .empty{ opacity:.75; }
.day.next-month .plus{
  opacity:.55;
  filter:saturate(.9) brightness(.95);
}

/* gentle lift on hover (keeps the glass vibe) */
.day.next-month:hover{
  transform: translateY(-1px);
  box-shadow: 0 16px 36px rgba(15,23,42,.14);
}

/* IMPORTANT: remove any overlay you previously added */
.day.next-month::after{ content:none !important; }
/* Past days in the *current* month */
.day.past-day{
  background: color-mix(in oklab, var(--panel-2) 55%, transparent);
  border-color: color-mix(in oklab, var(--ring) 75%, transparent);
}
.day.past-day .dnum{ color:#64748b; }

/* Hide/disable the add (+) only on past days of current month */
.day.past-day .plus{ opacity:.25; pointer-events:none; cursor:not-allowed; }

.card .pip{width:22px; height:22px; border-radius:7px; display:grid; place-items:center; color:#1d2435; font-size:12px; font-weight:900}
.timechip{margin-left:auto; font-weight:900; padding:2px 7px; border-radius:999px; background:rgba(255,255,255,.9); border:1px solid rgba(0,0,0,.05); font-size:10px}

/* platform colors */
.p-ig{background:#FFB7DA}
.p-fb{background:#BFD0FF}
.p-x{background:#CFD7E7}
.p-yt{background:#FFB8C0}
.p-tt{background:#FFD57A}
.p-bl{background:#BFE9CF}
.p-web{background:#FFC7AE}

/* ===================== PROFILE (mock-exact) ===================== */
.profile-card{
  max-width: 760px;
  background:var(--panel); border:1px solid var(--ring);
  border-radius:var(--radius-lg); box-shadow:var(--shadow-2);
  padding:16px 16px 18px; margin-top:12px;
}
.h2{font-weight:900; margin:0 0 8px 0}
.row{display:grid; grid-template-columns: 1fr 260px; gap:16px; align-items:start}
.input, .select, textarea{
  width:100%; padding:10px 12px; border:1px solid var(--ring); border-radius:12px; background:var(--panel); color:var(--ink); outline:none;
}
.input::placeholder, textarea::placeholder{color:#9aa3b2}
.input:focus, .select:focus, textarea:focus{border-color:color-mix(in oklab, var(--accent) 40%, var(--ring))}
.lab{font-size:12px; color:#7683a1; font-weight:800; margin:10px 0 6px}
.logoBox{
  width:120px; height:120px; border:1px dashed var(--ring); border-radius:12px; background:var(--panel-2);
  background-size:cover; background-position:center; margin-bottom:8px;
}
.link-add{display:inline-block; font-weight:800; color:#5c63d6; cursor:pointer; margin-top:6px}
.link-add:hover{text-decoration:underline}
.link-row{display:flex; gap:8px; margin-top:6px}
.savebar{display:flex; justify-content:flex-end; margin-top:12px}
.savebtn{
  border:1px solid transparent; color:#fff; font-weight:900; background:linear-gradient(135deg, var(--accent), color-mix(in oklab, var(--accent-2) 60%, #fff 40%));
  padding:10px 14px; border-radius:12px; box-shadow:0 10px 20px rgba(122,112,245,.2); cursor:pointer;
}

/* ===================== CAMPAIGNS + ANALYTICS placeholders ===================== */
.card{background:var(--panel)}

/* ===================== SETTINGS UI ===================== */
.settings-card{
  max-width: 900px;
  background:var(--panel);
  border:1px solid var(--ring);
  border-radius:var(--radius-lg);
  box-shadow:var(--shadow-2);
  padding:16px 16px 18px;
  margin-top:12px;
}
.settings-h2{font-weight:900; margin:0 0 8px 0}
.settings-grid{display:grid; gap:14px}
@media (min-width:800px){
  .settings-grid{grid-template-columns:1fr 1fr}
}
.set-row{
  display:grid; gap:8px;
  border:1px solid var(--ring);
  border-radius:12px; padding:12px;
  background:linear-gradient(180deg, var(--panel), var(--panel-2));
}
.set-label{font-weight:800}
.set-help{font-size:12px; color:var(--muted)}
.inline{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
.switch{
  --h:26px;
  position:relative; width:46px; height:var(--h);
  background:var(--panel); border:1px solid var(--ring); border-radius:999px;
  cursor:pointer;
}
.switch i{
  position:absolute; top:2px; left:2px; width:22px; height:22px;
  background:var(--chip); border:1px solid var(--chip-b); border-radius:999px;
  transition:left .15s ease;
}
.switch[data-on="true"]{background:color-mix(in oklab, var(--accent) 20%, var(--panel))}
.switch[data-on="true"] i{left:22px}
.select-sm, .input-sm{
  padding:8px 10px; border:1px solid var(--ring); border-radius:10px; background:var(--panel);
}
.btn-sec{
  border:1px solid var(--ring); background:var(--panel); border-radius:10px; padding:8px 10px; cursor:pointer; font-weight:800;
}
.btn-danger{
  border:1px solid #ffd6d6; background:#fff0f0; color:#9a2020; border-radius:10px; padding:8px 10px; cursor:pointer; font-weight:900;
}


/* ===================== RESPONSIVE ===================== */
@media (max-width:1000px){
  .app{grid-template-columns:78px 1fr}
  .brandname{display:none}
  .row{grid-template-columns:1fr}
}
/* highlight the Subscription link briefly when we jump to Settings */
@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(255,138,61,.45); }
  100% { box-shadow: 0 0 0 14px rgba(255,138,61,0); }
}
.settings-list a.pulse {
  border-radius: 8px;
  animation: pulse .8s ease-out 2;
}
 
/* ========== Settings 2-col layout ========== */
.settings-layout{
  display:grid;
  grid-template-columns: 260px 1fr;
  gap:18px;
  align-items:start;
}
.settings-menu{
  padding:14px 10px 8px;
}
.settings-menu h2{
  margin:0 0 10px;
  font-size:18px; font-weight:900;
}
.settings-list{ display:grid; gap:10px; }
.settings-list a{ font-weight:700; cursor:pointer; }
.settings-list a:hover{ text-decoration:underline; }
.settings-footer{ font-size:12px; color:var(--muted); margin-top:14px; }

/* Content stage (the red box area, styled as a panel) */
.settings-stage{
  min-height:560px;
  background:var(--panel);
  border:1px solid var(--ring);
  border-radius:var(--radius-lg);
  box-shadow:var(--shadow-2);
  padding:18px;
}

/* Small utilities for cards/buttons inside the stage */
.stage-row{ display:grid; gap:14px; }
.stage-card{
  border:1px solid var(--ring);
  border-radius:12px;
  padding:14px;
  background:linear-gradient(180deg, var(--panel), var(--panel-2));
}
.stage-title{ margin:0 0 8px; font-size:16px; font-weight:900; }
.stage-help{ font-size:12px; color:var(--muted); }

.stage-btn{
  display:inline-flex; align-items:center; gap:8px;
  padding:10px 12px; border-radius:10px; cursor:pointer;
  border:1px solid var(--ring); background:var(--panel); font-weight:800;
}
.stage-btn.primary{
  border:0; color:#fff; font-weight:900;
  background:linear-gradient(135deg, var(--accent), var(--accent-2));
  box-shadow:0 8px 16px rgba(0,0,0,.12);
}
.stage-btn[disabled]{ opacity:.5; cursor:not-allowed; }

/* Pricing cards */
.plan-grid{ display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
.plan{
  border:2px solid var(--ring); border-radius:14px; padding:14px;
  background:var(--panel-2);
}
.plan h3{ margin:0 0 6px; font-size:16px; font-weight:900; }
.plan .price{ font-weight:900; font-size:22px; }
.plan .meta{ font-size:12px; color:var(--muted); margin:6px 0 10px; }
.plan.selected{ border-color: color-mix(in oklab, var(--accent) 60%, var(--ring)); }
.plan .choose{ width:100%; }

/* Integrations */
.int-row{ display:flex; align-items:center; gap:10px; justify-content:space-between; padding:10px 0; border-bottom:1px dashed var(--ring); }
.int-row:last-child{ border-bottom:0; }
.int-name{ font-weight:800; }
.int-actions{ display:flex; align-items:center; gap:8px; }
.switch-min{
  position:relative; width:42px; height:24px; border-radius:999px;
  background:var(--panel); border:1px solid var(--ring); cursor:pointer;
}
.switch-min i{
  position:absolute; top:2px; left:2px; width:20px; height:20px; border-radius:999px;
  background:var(--chip); border:1px solid var(--chip-b); transition:left .15s ease;
}
.switch-min[data-on="true"]{ background:color-mix(in oklab, var(--accent) 22%, var(--panel)); }
.switch-min[data-on="true"] i{ left:20px; }

/* Pulse highlight used by Upgrade button jump */
.settings-list a.pulse{
  background: color-mix(in oklab, var(--accent-2) 15%, transparent);
  border-radius:10px; padding:2px 6px; transition: background .6s ease;
}
/* ---------- SETTINGS PANEL ---------- */
.settings-wrap{display:none; max-width:980px; margin:0 auto; padding:16px 14px 40px;}
.settings-grid{display:grid; grid-template-columns:180px 1fr; gap:14px;}
.settings-nav{background:rgba(255,255,255,.04); border:1px solid var(--line); border-radius:12px; padding:10px;}
.settings-nav h3{margin:6px 8px 10px; font-size:14px; color:var(--ink-dim); letter-spacing:.6px}
.settings-nav button{
  width:100%; display:block; text-align:left; padding:10px 12px; margin:4px 0;
  border-radius:10px; border:1px solid transparent; background:transparent; color:var(--ink);
  font-weight:700; letter-spacing:.4px;
}
.settings-nav button.active{background:rgba(255,255,255,.08); border-color:var(--line);}
.settings-card{
  background:rgba(255,255,255,.04); border:1px solid var(--line);
  border-radius:14px; padding:14px; min-height:220px;
  box-shadow:0 12px 28px rgba(0,0,0,.28);
}
.settings-card h2{margin:6px 2px 10px; font-size:18px}
.settings-muted{color:var(--ink-dim); font-size:13px}
.settings-btn{ height:40px; padding:0 14px; border-radius:10px; border:1px solid var(--ctrl-line);
  background:var(--ctrl-bg); color:var(--ctrl-ink); font-weight:800; letter-spacing:.8px; }
.settings-ghost{ background:transparent; color:var(--ink); border-color:var(--line); }
.field{display:grid; gap:6px; margin:10px 0 14px;}
.field label{color:var(--ink-dim); font-weight:700; font-size:12px; letter-spacing:.6px}
.field input{
  background:rgba(255,255,255,.06); border:1px solid var(--line);
  border-radius:10px; color:var(--ink); padding:10px 12px; font-weight:700;
}
.hide{display:none !important;}

</style>  <!-- ‚Üê add this line -->

<style id="campaigns-v2">
/* ==== Header card (matches your mock) ==== */
.campaign-header{
  display:flex; align-items:center; gap:12px;
  padding:14px 18px; margin-bottom:12px;
  background:var(--panel); border:1px solid var(--ring);
  border-radius:var(--radius-lg); box-shadow:var(--shadow-2);
}
.campaign-header .title{ margin:0; font-size:20px; font-weight:800; }
.campaign-header .meta{
  margin-left:auto; margin-right:12px;
  font-size:13px; font-weight:700; color:var(--muted);
}
.campaign-header .btn.primary{
  border:0; color:#fff; font-weight:900;
  padding:8px 14px; border-radius:12px; cursor:pointer;
  background:linear-gradient(135deg, var(--accent), var(--accent-2));
  box-shadow:0 8px 16px rgba(0,0,0,.12);
}
.campaign-header .btn.primary:hover{ filter:brightness(1.05); }

/* ==== Table card ==== */
.campaign-table{
  background:var(--panel); border:1px solid var(--ring);
  border-radius:var(--radius-lg); box-shadow:var(--shadow-1);
  overflow:hidden;
}

/* Columns ‚Äì clean fixed grid */
.camp-row{
  display:grid;
  grid-template-columns: 1.2fr 1.2fr 1fr 1fr 1fr 1.2fr 1fr 1.2fr;
  align-items:center; padding:10px 16px;
}
.camp-row.camp-head{
  font-size:13px; font-weight:900; text-transform:uppercase;
  border-bottom:1px solid var(--ring);
}
.camp-col + .camp-col{
  border-left:1px solid rgba(15,23,42,.06);
  padding-left:12px;
}

/* Hover for future body rows */
.camp-body .camp-row:hover{
  background:color-mix(in oklab, var(--panel-2) 40%, transparent);
}

/* Responsive trims */
@media (max-width:1200px){
  .camp-row{ grid-template-columns: 1.3fr 1.1fr 1fr 0.9fr 0.9fr 1.1fr 0.9fr 1.1fr; }
}
@media (max-width:980px){
  .campaign-table .camp-row .camp-col:nth-child(8){ display:none; } /* hide Additional */
  .camp-row{ grid-template-columns: 1.4fr 1.1fr 1fr 1fr 1fr 1.1fr 1fr; }
}/* === Fill full width with CSS vars per column (defaults are fr) === */
.campaign-table .camp-row{
  display:grid;
  grid-template-columns: var(--camp-cols);
  align-items:center;
  padding:10px 16px;
}


/* Header look */
.campaign-table .camp-row.camp-head{
  font-size:13px; font-weight:900; text-transform:uppercase;
  border-bottom:1px solid var(--ring);
}

/* Cell separators */
.campaign-table .camp-col + .camp-col{
  border-left:1px solid rgba(15,23,42,.06);
  padding-left:12px;
}

/* === Resize grip === */
.campaign-table .camp-head .camp-col{ position:relative; }
.campaign-table .col-grip{
  position:absolute; top:0; right:-6px; width:12px; height:100%;
  cursor:col-resize; border-right:2px solid transparent;
}
.campaign-table .col-grip:hover{ border-right-color:rgba(15,23,42,.2); }

/* Hover for future body rows */
.camp-body .camp-row:hover{
  background:color-mix(in oklab, var(--panel-2) 40%, transparent);
}

/* Responsive trims */
@media (max-width:1200px){
  .campaign-table .camp-row{
    grid-template-columns:
      minmax(140px, var(--c-name, 1.35fr))
      minmax(120px, var(--c-objective, 1.1fr))
      minmax(140px, var(--c-range, 1.1fr))
      minmax(120px, var(--c-posts, 1fr))
      minmax(110px, var(--c-status, 0.95fr))
      minmax(140px, var(--c-platforms, 1.1fr))
      minmax(110px, var(--c-tone, 0.9fr))
      minmax(140px, var(--c-notes, 1.05fr));
  }
}
@media (max-width:980px){
  .campaign-table .camp-row .camp-col[data-key="notes"]{ display:none; }
  .campaign-table .camp-row{
    grid-template-columns:
      minmax(140px, var(--c-name, 1.5fr))
      minmax(120px, var(--c-objective, 1.1fr))
      minmax(140px, var(--c-range, 1.2fr))
      minmax(120px, var(--c-posts, 1fr))
      minmax(110px, var(--c-status, 1fr))
      minmax(140px, var(--c-platforms, 1.1fr))
      minmax(110px, var(--c-tone, 1fr));
  }
}
/* ---- sortable headers ---- */
.campaign-table .camp-head .camp-col {
  cursor: default;
  user-select: none;
}
.campaign-table .camp-head .camp-col.sortable {
  cursor: pointer;
}
.campaign-table .camp-head .camp-col.sortable:hover {
  text-decoration: underline;
}

/* ---- little arrow driven by aria-sort on the header ---- */
.campaign-table .camp-head .camp-col::after {
  content: ""; display:inline-block; width:12px; margin-left:6px;
}
.campaign-table .camp-head .camp-col[aria-sort="asc"]::after  { content:"‚ñ≤"; font-size:10px; }
.campaign-table .camp-head .camp-col[aria-sort="desc"]::after { content:"‚ñº"; font-size:10px; }
/* kill the header-row divider */
.campaign-table .camp-row.camp-head{
  border-bottom: 0 !important;
}
/* Account submenu (left-column look, but inside the stage) */
.sub-list{
  display:grid;
  gap:10px;
  margin: 6px 0 12px;
}
.sub-list a{
  font-weight:700;
  cursor:pointer;
}
.sub-list a:hover{ text-decoration: underline; }
.sub-list a.active{
  text-decoration: underline;
}
/* Past days in the current month */
.day.past-day {
  opacity: 0.35;
  filter: grayscale(0.3);
  pointer-events: none;   /* disable clicks if you don‚Äôt want + active */
}
.day.past-day .plus {
  opacity: 0.25;
  cursor: not-allowed;
}

</style>
<style>
/* center header labels */
.campaign-table .camp-head .camp-col{
  display:flex; align-items:center; justify-content:center;
  text-align:center;
}

/* list container */
.camp-list{
  margin-top:10px;
  display:grid;
  gap:8px;   /* tighter vertical rhythm */
}


/* campaign ‚Äúrow‚Äù as a card */
.camp-card{
  background:
    linear-gradient(180deg,
      color-mix(in oklab, var(--panel-2) 78%, transparent) 0%,
      color-mix(in oklab, var(--accent) 10%, transparent) 100%);
  border:1px solid color-mix(in oklab, var(--ring) 75%, transparent);
  border-radius:var(--radius-lg);
  box-shadow:var(--shadow-1);
  padding:14px 16px;
  display:grid;
  backdrop-filter: saturate(1.06);
  grid-template-columns: var(--camp-cols);
  align-items:center;
  column-gap:14px;
}
[data-theme="night"] .camp-card{
  background:
    linear-gradient(180deg,
      color-mix(in oklab, var(--panel-2) 68%, transparent) 0%,
      color-mix(in oklab, var(--accent) 16%, transparent) 100%);
  border-color: color-mix(in oklab, var(--ring) 60%, transparent);
}



.camp-cell{
  display:flex; align-items:center; justify-content:center; text-align:center;
}

/* subtle separators that echo the header look */
.camp-card .camp-cell + .camp-cell{
  border-left:1px solid rgba(15,23,42,.06);
  padding-left:12px;
}

/* mild hover lift */
.camp-card:hover{
  transform:translateY(-1px);
  box-shadow:0 16px 36px rgba(15,23,42,.10);
  transition:transform .08s ease, box-shadow .15s ease;
}

/* responsive */
@media (max-width:1100px){
  .camp-card{
    grid-template-columns:
      1.3fr 1.1fr 1.2fr .8fr 1fr 1.1fr 1fr;
  }
  .camp-card .camp-cell[data-key="notes"]{ display:none; }
}
@media (max-width:860px){
  .camp-card{
    grid-template-columns: 1.4fr 1.1fr 1.2fr .8fr 1fr 1.1fr;
  }
  .camp-card .camp-cell[data-key="tone"]{ display:none; }
}
</style>
<style>
/* ========== Settings Floating Card ========== */
.settings-float {
  max-width: 360px;
  margin: 40px auto;
  background: var(--panel);
  border: 1px solid var(--ring);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-2);
  padding: 20px 22px 26px;
  text-align: left;
}

.settings-float h2 {
  margin: 0 0 14px;
  font-size: 18px;
  font-weight: 900;
}

.settings-list {
  display: grid;
  gap: 10px;
  margin: 0 0 18px;
}

.settings-list a {
  font-weight: 600;
  cursor: pointer;
  color: var(--ink);
}
.settings-list a:hover {
  text-decoration: underline;
}

.settings-footer {
  font-size: 12px;
  color: var(--muted);
  margin-top: 16px;
}



.settings-close {
  display: inline-block;
  margin-top: 6px;
  padding: 6px 12px;
  font-weight: 800;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  color: #fff;
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  box-shadow: 0 6px 12px rgba(0,0,0,.12);
}
.settings-close:hover {
  filter: brightness(1.05);
}
</style>
<style>
/* ===== Compose Modal ===== */
.compose-backdrop{
  position:fixed; inset:0; display:none; place-items:center; z-index:50;
  background:rgba(15,23,42,.32);  /* dark overlay */
  /* no blur */
}

.compose-backdrop.open{ display:grid; }

.compose-card{
  width: min(460px, 92vw);   /* narrower than before */
  background: var(--panel); border:1px solid var(--ring);
  border-radius:16px; box-shadow:0 20px 40px rgba(0,0,0,.28);
  padding:16px; position:relative;
}


/* give room for the small AI chip that sits inside the input */
.c-row.two .c-input { padding-right: 56px; }

.compose-title{ font-weight:900; font-size:18px; margin:0 0 10px; }

.c-row{ display:grid; grid-template-columns:1fr auto; gap:8px; margin:8px 0; }
.c-input, .c-textarea, .c-select{
  width:100%; padding:10px 12px; border:1px solid var(--ring);
  border-radius:12px; background:var(--panel); color:var(--ink); outline:none;
}
.c-textarea{ min-height:64px; resize:vertical; }
.ai-btn{
  border:0; border-radius:10px; padding:10px 12px; cursor:pointer; font-weight:900; color:#fff;
  background:linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow:0 8px 16px rgba(0,0,0,.12);
}
.c-inline{ display:flex; gap:10px; align-items:center; margin:8px 0; }

.pill-chip{
  border:1px solid var(--ring); background:var(--panel);
  border-radius:999px; padding:6px 10px; font-weight:800; cursor:pointer;
}
.pill-chip[data-on="true"]{
  color:#fff; border-color:transparent;
  background:linear-gradient(135deg, var(--accent), var(--accent-2));
}

.compose-actions{
  display:flex; justify-content:flex-end; gap:10px; margin-top:12px;
}

.btn-ghost{ border:1px solid var(--ring); background:var(--panel); border-radius:10px; padding:10px 12px; font-weight:800; cursor:pointer; }
.btn-primary{
  border:0; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:900; color:#fff;
  background:linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow:0 10px 20px rgba(0,0,0,.12);
}
.compose-close{
  position:absolute; top:8px; right:8px; border:1px solid var(--ring);
  background:var(--panel); border-radius:10px; padding:6px 8px; font-weight:900; cursor:pointer;
}
.small-help{ font-size:12px; color:var(--muted); margin-top:2px; }
.c-row.three { grid-template-columns: 1fr auto auto; }


</style>
</head>
<body>

<div class="app">
  <!-- SIDEBAR -->
  <aside class="side">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="brandname">Phasee</div>
    </div>

<nav class="nav" id="nav">
  <a href="#profile" data-page="profile"><span>Profile</span></a>
  <a href="#calendar" data-page="calendar" data-active="true"><span>Calendar</span></a>
</nav>


    <div class="foot">
      <a class="settings-link" id="openSettings">Settings</a>
      <div class="plan-wrap">
        <div class="plan-name" id="planName">Phasee Core</div>
        <button class="upgrade" id="upgradeBtn">Upgrade Plan</button>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <section class="main">
    <!-- TOP BAR -->
    <header class="top">
  <div class="controls">
  <select class="iconbtn" id="accountSel">
    <option>Acme Co</option><option>Northwind</option><option>Contoso</option>
  </select>
</div>

    </header>

    <!-- CONTENT -->
    <div class="wrap">
      <!-- CALENDAR (default) -->
      <div class="page active" id="pageCalendar">
        <div class="calendar">
 <div class="cal-header">
  <div class="cal-mid">
    <button class="monthbtn" id="prev">‚Äπ</button>
    <div class="monthlabel" id="monthLabel">‚Äî</div>
    <button class="monthbtn" id="next">‚Ä∫</button>

  </div>

  <div class="cal-right">
    <button id="viewByBtn" class="iconbtn">üëÅ</button>
    <div class="dropdown" id="viewByMenu" aria-label="Filter platforms"></div>
  </div>
</div>


  <div class="weeks" id="weeks"></div>
  <div class="grid" id="grid"></div>
</div> <!-- .calendar -->
</div> <!-- #pageCalendar -->


      <!-- PROFILE (mock) -->
      <div class="page" id="pageProfile">
        <div class="profile-card">
          <h2 class="h2">Profile</h2>

          <div class="row">
            <div>
              <div class="lab">Company / Brand</div>
              <input class="input" id="pName" placeholder="e.g., Acme Co">

              <div class="lab">Industry</div>
              <input class="input" id="pIndustry" placeholder="e.g., DTC skincare">

              <div class="lab">Tone / Culture</div>
              <input class="input" id="pTone" placeholder="e.g., Playful, Bold">

              <div class="lab">Founded (Year)</div>
              <select class="select" id="pYear"></select>

              <div class="lab">Motto</div>
              <input class="input" id="pMotto" placeholder="">

              <div class="lab">Bio</div>
              <textarea id="pBio" rows="3" class="input" placeholder=""></textarea>

              <div class="lab">Additional Information</div>
              <textarea id="pNotes" rows="3" class="input" placeholder="Anything that helps us build better prompts & comps"></textarea>
            </div>

            <div>
              <div class="lab">Logo / Image</div>
              <div class="logoBox" id="pLogoBox"></div>
              <input type="file" id="pLogo" accept="image/*">

              <div class="lab" style="margin-top:16px">Links</div>
              <div id="linkWrap"></div>
              <span class="link-add" id="addLink">+ Add</span>
            </div>
          </div>

          <div class="savebar">
            <button class="savebtn" id="profileSave">Save</button>
          </div>
        </div>
      </div>

      <!-- CAMPAIGNS (kept minimal; will refine later) -->
   
<section id="pageCampaigns" class="page" aria-label="Campaigns">
  <!-- Header card -->
  <div class="card campaign-header">
    <h2 class="title">Campaigns</h2>
    <div class="meta" id="campScheduled">0 Scheduled</div>
    <button id="btnNewCampaign" class="btn primary">+ Campaign</button>
  </div>

  <!-- Table card -->
  <div class="card campaign-table">
  <div class="camp-row camp-head" role="row">
    <div class="camp-col" role="columnheader" data-key="name">Name<i class="col-grip" aria-hidden="true"></i></div>
    <div class="camp-col" role="columnheader" data-key="objective">Objective<i class="col-grip" aria-hidden="true"></i></div>
    <div class="camp-col" role="columnheader" data-key="range">Start/End<i class="col-grip" aria-hidden="true"></i></div>
    <div class="camp-col" role="columnheader" data-key="posts">Posts/Days<i class="col-grip" aria-hidden="true"></i></div>
    <div class="camp-col" role="columnheader" data-key="status">Status<i class="col-grip" aria-hidden="true"></i></div>
    <div class="camp-col" role="columnheader" data-key="platforms">Platforms<i class="col-grip" aria-hidden="true"></i></div>
    <div class="camp-col" role="columnheader" data-key="tone">Tone<i class="col-grip" aria-hidden="true"></i></div>
    <div class="camp-col" role="columnheader" data-key="notes">Additional<i class="col-grip" aria-hidden="true"></i></div>
  </div>
</div>

<!-- NEW: card list lives outside the header table -->
<div id="campList" class="camp-list"></div>

</section>

      <!-- ANALYTICS (kept minimal; will refine later) -->
      <div class="page" id="pageAnalytics">
        <div class="profile-card">
          <h2 class="h2">Analytics</h2>
          <div>Industry / Competitors / Personal comparison cards. (Placeholder)</div>
        </div>
      </div>

      <!-- SETTINGS (navigated from bottom link) -->
<div class="page" id="pageSettings">
  <div class="settings-layout">
    <!-- Left menu -->
    <div class="settings-menu">
      <h2>Settings</h2>
      <div class="settings-list">
  <a id="setAccount">Account</a>
  <a id="setIntegrations">Integrations</a>
  <a id="setSubscription">Subscription</a>
  <a id="setLogout">Log out</a>
  <a id="setHelp">Help</a>
</div>

      <div class="settings-footer">¬© Phasee 2026</div>
    </div>

    <!-- Right content stage (this is your red box area) -->
    <div class="settings-stage" id="settingsStage" role="region" aria-live="polite"></div>
  </div> <!-- .settings-layout -->
</div>   <!-- #pageSettings -->


<script>
/* ======= Helpers ======= */
const $  = (sel, root=document) => root.querySelector(sel);
const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
const isoOf = (y,m,d)=> new Date(y,m,d).toISOString().slice(0,10);
function saveLS(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
function loadLS(k,fb){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):fb }catch{ return fb } }

/* ======= Storage Keys ======= */
const DB_KEY = 'phasee-db-v1';
const SETTINGS_KEY = 'phasee-settings-v1';
const FILTERS_KEY = 'phasee-filters-v1';
const PROFILE_KEY = 'phasee-profile-v1';
/* ======= Campaigns storage ======= */
const CAMPAIGNS_KEY = 'phasee-campaigns-v1';
const CAMP_SORT_KEY = 'phasee-camp-sort-v1';

let campaigns = loadLS(CAMPAIGNS_KEY, []);                     // [{name, objective, start, end, posts, status, platforms[], tone, notes}]
let campSort  = loadLS(CAMP_SORT_KEY, { key:'name', dir:'asc' }); // persisted sort {key, dir}

if (!campaigns.length){
  campaigns = [
    {name:'Fall Launch', objective:'Awareness', start:'2025-09-01', end:'2025-09-30', posts:3, status:'Queued', platforms:['Instagram','TikTok'], tone:'Playful', notes:'UGC focus'},
    {name:'VIP Drop',   objective:'Conversion', start:'2025-08-15', end:'2025-08-20', posts:2, status:'Active',  platforms:['Instagram','X'],     tone:'Hype',    notes:'Limited stock'},
    {name:'Evergreen',  objective:'Retention',  start:'2025-07-01', end:'2025-12-31', posts:1, status:'Active',  platforms:['Blog','Website'],    tone:'Helpful', notes:''},
  ];
  saveLS(CAMPAIGNS_KEY, campaigns);
}
// ===== Compose modal state =====
let composeISO = null;
let composeMedia = null;  // <-- NEW: holds the selected file (as dataURL + name)

// When you define openCompose(iso)‚Ä¶
function openCompose(iso){
  composeISO = iso;

  // reset fields
  document.getElementById('cmpContent').value = '';
  document.getElementById('cmpCopy').value = '';


  // reset media UI
  composeMedia = null;
  const meta = document.getElementById('uploadMeta');
  if (meta) meta.textContent = '';

  // fill time options (08:00‚Äì20:30 every 30min)
  const timeSel = document.getElementById('cmpTime');
if (timeSel){
  timeSel.innerHTML = '';
  const label12 = (H, m) => {
    const suffix = H >= 12 ? 'PM' : 'AM';
    const h12 = H % 12 === 0 ? 12 : H % 12;
    return `${h12}:${String(m).padStart(2,'0')} ${suffix}`;
  };
  for (let H=8; H<=20; H++){
    [0,30].forEach(m=>{
      const label = label12(H, m);
      const o = document.createElement('option');
      o.value = label;      // store human-readable
      o.textContent = label;
      timeSel.appendChild(o);
    });
  }
}

 // platform chips (single-select / radio behavior)
const platWrap = document.getElementById('cmpPlatWrap');
if (platWrap){
  platWrap.innerHTML = '';
  PLATS.forEach((p, i)=>{
    const chip = document.createElement('button');
    chip.type = 'button';
    chip.className = 'pill-chip';
    chip.dataset.on = (i === 0 ? 'true' : 'false');  // first selected
    chip.textContent = p.key;
    chip.addEventListener('click', ()=>{
      platWrap.querySelectorAll('.pill-chip').forEach(c=> c.dataset.on = 'false');
      chip.dataset.on = 'true';
    });
    platWrap.appendChild(chip);
  });
}

  // friendly date hint
  const help = document.getElementById('composeDateHelp');
  if (help && iso){
    const d = new Date(iso);
    help.textContent = `Scheduling for ${d.toLocaleDateString()} (${iso})`;
  }

  // finally, open the modal
  document.getElementById('composeWrap')?.classList.add('open');
}
// Upload button triggers the hidden <input type="file">
document.getElementById('uploadBtn')?.addEventListener('click', () => {
  document.getElementById('cmpUpload').click();
});

// Read the selected file into memory (data URL) and show a tiny label
document.getElementById('cmpUpload')?.addEventListener('change', (e) => {
  const f = e.target.files?.[0];
  if (!f) return;
  const r = new FileReader();
  r.onload = () => {
    composeMedia = { name: f.name, type: f.type, dataURL: r.result };
    const meta = document.getElementById('uploadMeta');
    if (meta) meta.textContent = `Attached: ${f.name}`;
  };
  r.readAsDataURL(f);
});

/* ======= State ======= */
let db = loadLS(DB_KEY, {});                 // { 'YYYY-MM-DD': [ {platform,title,time,...}, ... ] }
let filters = loadLS(FILTERS_KEY, {Instagram:true, Facebook:true, X:true, YouTube:true, TikTok:true, Blog:true, Website:true});
let settings = loadLS(SETTINGS_KEY, {
  theme: document.documentElement.getAttribute('data-theme') || 'day',
  density: 'comfortable',
  weekStart: 'sun',
  dateFormat: 'MMM d, yyyy',
  tzAuto: true,
  tzManual: 'local',
  notifEmail: false,
  notifPush: false,
  integrations: { Instagram:false, Facebook:false, X:false, TikTok:false },
  account: { loggedIn:false, email:'' },
  plan: 'free'   // 'free' | 'core' | 'pro'
});

function isLoggedIn(){ return !!(settings.account && settings.account.loggedIn); }
function refreshVisibility(){
  // sidebar: hide Campaigns unless logged in
  const campLink = document.querySelector('#nav a[data-page="campaigns"]');
  if (campLink) campLink.style.display = isLoggedIn() ? '' : 'none';

  // settings left menu: hide gated items when logged out
  ['setIntegrations','setSubscription','setLogout'].forEach(id=>{
    const el = document.getElementById(id);
    if (el) el.style.display = isLoggedIn() ? '' : 'none';
  });
}

let profile = loadLS(PROFILE_KEY, {links:[]});

/* ======= Platforms for View-by ======= */
const PLATS = [
  {key:'Instagram', cls:'p-ig', dot:'#E8447C'},
  {key:'Facebook',  cls:'p-fb', dot:'#1877F2'},
  {key:'X',         cls:'p-x',  dot:'#111'},
  {key:'TikTok',    cls:'p-tt', dot:'#00F2EA'},

];

/* ======= Nav Switching ======= */
const pages = {
  calendar: $('#pageCalendar'),
  profile: $('#pageProfile'),
  settings: $('#pageSettings')
};

function showPage(name){

  if(!pages[name]) return;

  // route + persist
  history.replaceState(null, '', `#${name}`);
  localStorage.setItem('phasee-last-page', name);

  // transitions
  Object.values(pages).forEach(p=>p.classList.remove('active','entering'));
  const el = pages[name];
  el.classList.add('active');
  requestAnimationFrame(()=> el.classList.add('entering'));

  // sidebar highlight
  $$('#nav a').forEach(a=>a.dataset.active = (a.dataset.page===name));

  // keep menu visibility in sync
  refreshVisibility();
}

// sidebar clicks -> route
$('#nav').addEventListener('click',(e)=>{
  const a = e.target.closest('a'); if(!a) return;
  e.preventDefault();
  showPage(a.dataset.page);
});

// footer settings -> route
$('#openSettings').addEventListener('click', (e)=>{
  e.preventDefault();
  showPage('settings');
});

// route on hash change (e.g., manual typing, back/forward)
window.addEventListener('hashchange', ()=>{
  const name = (location.hash || '#calendar').slice(1);
  showPage(pages[name] ? name : 'calendar');
});

// boot into last page or hash
(function bootRoute(){
  const fromHash = (location.hash || '').slice(1);
  const last = localStorage.getItem('phasee-last-page') || 'calendar';
  showPage(pages[fromHash] ? fromHash : last);
})();


/* ======= Month + Calendar ======= */
let anchor = new Date();            // <- NEW
anchor.setHours(0,0,0,0);           // normalize to midnight

let view = (()=>{const d=new Date(); return {y:d.getFullYear(), m:d.getMonth()}})();
const grid = $('#grid');
const monthLabel = $('#monthLabel');
// Returns the start-of-week (Sun/Mon) for a given date
function startOfWeek(date, weekStart = (settings?.weekStart || 'sun')){
  const d = new Date(date);
  d.setHours(0,0,0,0);
  const start = weekStart === 'mon' ? 1 : 0; // 1 = Monday, 0 = Sunday
  const diff = (d.getDay() - start + 7) % 7;
  d.setDate(d.getDate() - diff);
  return d;
}
// Dynamic week header that starts on the same weekday as the first visible cell
const weeksEl = $('#weeks');
function setWeekHeaderFor(date){
  const labels = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const i = new Date(date).getDay();      // 0=Sun..6=Sat for the first column
  const ordered = labels.slice(i).concat(labels.slice(0, i));
  if (weeksEl) weeksEl.innerHTML = ordered.map(d => `<div>${d}</div>`).join('');
}

// Show exactly 31 consecutive days starting TODAY, top-left = today
function buildCalendar(){
  grid.innerHTML = '';

  // always anchor at the current anchor date
  const start = new Date(anchor);               // <- CHANGED
  setWeekHeaderFor(start);

  const baseMonth = start.getMonth(), baseYear = start.getFullYear();
  const today = new Date(); today.setHours(0,0,0,0);
  const todayISO = today.toISOString().slice(0,10);

  // Label ...
  const end = new Date(start); end.setDate(start.getDate() + 30);
  const sameMonth = start.getMonth() === end.getMonth() && start.getFullYear() === end.getFullYear();
  monthLabel.textContent = sameMonth
    ? start.toLocaleString(undefined, { month:'long', year:'numeric' })
    : `${start.toLocaleString(undefined,{ month:'long', year:'numeric' })} ‚Äì ${end.toLocaleString(undefined,{ month:'long', year:'numeric' })}`;

  // Build 31 cells (grid will naturally wrap rows; last row will be partial)
  for (let i = 0; i < 31; i++){
    const d = new Date(start); d.setDate(start.getDate() + i);
    const iso = d.toISOString().slice(0,10);

    const cell = document.createElement('div');
    cell.className = 'day';
if (d < today) cell.classList.add('past-day');
    cell.dataset.iso = iso;

    // Darker style when the day spills into the next month
    if (d.getMonth() !== baseMonth || d.getFullYear() !== baseYear){
      cell.classList.add('next-month');
    }

    // Mark today
    if (iso === todayISO) cell.classList.add('selected');

    // Header
    const head = document.createElement('div'); head.className = 'dhead';
    const dnum = document.createElement('div'); dnum.className = 'dnum'; dnum.textContent = d.getDate();
    head.appendChild(dnum);

    // + button for today/future (everything here is today+)
    const plus = document.createElement('button');
    plus.className = 'plus'; plus.textContent = '+'; plus.title = 'Quick add';
    plus.onclick = (e)=>{ e.stopPropagation(); quickAdd(iso); };
    head.appendChild(plus);

    // Items
    const list  = document.createElement('div');
    const items = (db[iso] || []).filter(it => filters[it.platform ?? ''] !== false);
    if (!items.length){
      list.innerHTML = '<div class="empty">No items</div>';
    } else {
      items.forEach(it=>{
        const card  = document.createElement('div'); card.className = 'card';
        const cls   = (PLATS.find(p => p.key.toLowerCase() === (it.platform||'').toLowerCase())?.cls) || 'p-bl';
        const pip   = document.createElement('div'); pip.className = `pip ${cls}`; pip.textContent = (it.platform||'P')[0]||'P';
        const title = document.createElement('div'); title.textContent = it.title || 'Untitled';
        const time  = document.createElement('div'); time.className = 'timechip'; time.textContent = it.time || '‚Äî';
        card.append(pip, title, time);
        list.append(card);
      });
    }

    cell.append(head, list);
    grid.append(cell);
  }
}

function quickAdd(iso){
  openCompose(iso);
}
$('#prev').onclick = () => {
  anchor.setDate(anchor.getDate() - 31);  // slide window back
  buildCalendar();
};
// Scroll the week that contains "today" to the top of the viewport


$('#next').onclick = () => {
  anchor.setDate(anchor.getDate() + 31);  // slide window forward
  buildCalendar();
};

// Scroll the week that contains "today" to the top of the viewport


/* ======= View-by (Eye) ======= */
const viewByBtn = $('#viewByBtn');
const viewByMenu = $('#viewByMenu');

function renderViewBy(){
  viewByMenu.innerHTML='';
  PLATS.forEach(p=>{
    const row = document.createElement('label'); row.className='drop-row';
    const chip = document.createElement('span'); chip.className='pill';
    const dot = document.createElement('span'); dot.className='dot'; dot.style.background=p.dot;
    chip.append(dot, document.createTextNode(' '+p.key));
    const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = filters[p.key]!==false;
    cb.style.marginLeft='auto';
    cb.addEventListener('change', ()=>{ filters[p.key]=cb.checked; saveLS(FILTERS_KEY, filters); buildCalendar(view.y, view.m); });
    row.append(chip, cb);
    viewByMenu.appendChild(row);
  });
}
viewByBtn.addEventListener('click', (e)=>{ e.stopPropagation(); viewByMenu.classList.toggle('open'); });
document.addEventListener('click', (e)=>{ if(!e.target.closest('#viewByMenu') && !e.target.closest('#viewByBtn')) viewByMenu.classList.remove('open'); });

/* ======= Profile Tab (mock-exact) ======= */
function yearOptions(){
  const sel = $('#pYear'); sel.innerHTML='';
  const now = new Date().getFullYear();
  for(let y=now; y>=1900; y--){
    const opt=document.createElement('option'); opt.value=String(y); opt.textContent=String(y);
    sel.append(opt);
  }
}

function loadProfileUI(){
  $('#pName').value = profile.name||'';
  $('#pIndustry').value = profile.industry||'';
  $('#pTone').value = profile.tone||'';
  $('#pYear').value = profile.year || String(new Date().getFullYear());
  $('#pMotto').value = profile.motto||'';
  $('#pBio').value = profile.bio||'';
  $('#pNotes').value = profile.notes||'';

  // links
  const wrap = $('#linkWrap'); wrap.innerHTML='';
  (profile.links||[]).forEach((v,i)=> addLinkInput(v));
  if((profile.links||[]).length===0) addLinkInput('');

  // logo preview
  const box = $('#pLogoBox'); box.style.backgroundImage = profile.logo ? `url(${profile.logo})` : 'none';
}
function addLinkInput(value=''){
  const wrap = $('#linkWrap');
  const row = document.createElement('div'); row.className='link-row';
  const inp = document.createElement('input'); inp.className='input'; inp.placeholder='https://'; inp.value=value;
  const del = document.createElement('button'); del.className='monthbtn'; del.textContent='Remove';
  del.onclick=()=>{ row.remove(); };
  row.append(inp, del);
  wrap.append(row);
}
$('#addLink').addEventListener('click', ()=> addLinkInput(''));

$('#pLogo').addEventListener('change',(e)=>{
  const f = e.target.files?.[0]; if(!f) return;
  const r = new FileReader();
  r.onload = ()=>{ $('#pLogoBox').style.backgroundImage = `url(${r.result})`; profile.logo = r.result; };
  r.readAsDataURL(f);
});
$('#profileSave').addEventListener('click', ()=>{
  const links = Array.from($('#linkWrap').querySelectorAll('input')).map(i=>i.value.trim()).filter(Boolean);
  profile = {
    name: $('#pName').value.trim(),
    industry: $('#pIndustry').value.trim(),
    tone: $('#pTone').value.trim(),
    year: $('#pYear').value,
    motto: $('#pMotto').value.trim(),
    bio: $('#pBio').value.trim(),
    notes: $('#pNotes').value.trim(),
    logo: profile.logo || null,
    links
  };
  saveLS(PROFILE_KEY, profile);
  const btn = $('#profileSave'); const prev = btn.textContent;
  btn.textContent='Saved ‚úì'; setTimeout(()=> btn.textContent=prev, 1200);
});

/* ======= Settings ======= */

// small util for switch divs
function bindSwitch(id, getVal, setVal){
  const el = document.getElementById(id);
  if (!el) return;
  const apply = (v)=>{ el.dataset.on = v ? 'true' : 'false'; el.setAttribute('aria-checked', v?'true':'false'); };
  apply(getVal());
  el.addEventListener('click', ()=>{
    const v = !getVal();
    setVal(v);
    apply(v);
    saveLS(SETTINGS_KEY, settings);
    applySettingsEffects();
  });
}

// simple date formatter (supports a few tokens)
function formatDateStr(iso, fmt){
  if (!iso) return '‚Äî';
  const d = new Date(iso);
  const MMM = d.toLocaleString(undefined,{month:'short'});
  const MM  = String(d.getMonth()+1).padStart(2,'0');
  const dd  = String(d.getDate()).padStart(2,'0');
  const d_  = d.getDate();
  const yyyy= d.getFullYear();
  return fmt
    .replace('MMM', MMM)
    .replace('MM', MM)
    .replace('dd', dd)
    .replace('d', d_)
    .replace('yyyy', yyyy);
}
function formatRange(a,b){ return `${formatDateStr(a, settings.dateFormat)} ‚Äì ${formatDateStr(b, settings.dateFormat)}`; }

// apply density + theme immediately
function applySettingsEffects(){
  document.documentElement.setAttribute('data-theme', settings.theme||'day');
  document.body.classList.toggle('dense', settings.density==='compact');

  // week-start label (just updates labels, not grid math)
  const weeks = document.querySelector('.weeks');
  if (weeks){
    weeks.innerHTML = (settings.weekStart==='mon')
      ? '<div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>'
      : '<div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>';
  }
}

// compact density CSS tweaks
const densityStyle = document.createElement('style');
densityStyle.textContent = `
  body.dense .camp-row, body.dense .camp-card{ padding:10px 12px; }
  body.dense .camp-card{ column-gap:10px; }
  body.dense .camp-card .camp-cell + .camp-cell{ padding-left:8px; }
  body.dense .profile-card, body.dense .settings-card{ padding:14px; }
  body.dense .monthbtn, body.dense .iconbtn{ padding:5px 8px; }
`;
document.head.appendChild(densityStyle);

// populate Settings UI
function loadSettingsUI(){
  // theme radios
  $$('input[name="theme"]').forEach(r=>{
    r.checked = (r.value===settings.theme);
    r.addEventListener('change', ()=>{
      settings.theme = r.value;
      saveLS(SETTINGS_KEY, settings);
      applySettingsEffects();
    });
  });

  // density
  const densitySel = document.getElementById('densitySel');
  if (densitySel){
    densitySel.value = settings.density;
    densitySel.addEventListener('change', ()=>{
      settings.density = densitySel.value;
      saveLS(SETTINGS_KEY, settings);
      applySettingsEffects();
    });
  }

  // week start
  const weekStartSel = document.getElementById('weekStartSel');
  if (weekStartSel){
    weekStartSel.value = settings.weekStart;
    weekStartSel.addEventListener('change', ()=>{
      settings.weekStart = weekStartSel.value;
      saveLS(SETTINGS_KEY, settings);
      applySettingsEffects();
    });
  }

  // date format
  const dateFmtSel = document.getElementById('dateFmtSel');
  if (dateFmtSel){
    dateFmtSel.value = settings.dateFormat;
    dateFmtSel.addEventListener('change', ()=>{
      settings.dateFormat = dateFmtSel.value;
      saveLS(SETTINGS_KEY, settings);
      renderCampaignRows(); // update visible ranges
    });
  }

  // timezone
  bindSwitch('tzAuto', ()=>settings.tzAuto, v=>settings.tzAuto=v);
  const tzManualSel = document.getElementById('tzManualSel');
  if (tzManualSel){
    tzManualSel.value = settings.tzManual;
    tzManualSel.addEventListener('change', ()=>{
      settings.tzManual = tzManualSel.value;
      saveLS(SETTINGS_KEY, settings);
    });
  }

  // notifications
  bindSwitch('notifEmail', ()=>settings.notifEmail, v=>settings.notifEmail=v);
  bindSwitch('notifPush',  ()=>settings.notifPush,  v=>settings.notifPush=v);

  // integrations
  bindSwitch('intIG', ()=>settings.integrations.IG, v=>settings.integrations.IG=v);
  bindSwitch('intTT', ()=>settings.integrations.TT, v=>settings.integrations.TT=v);
  bindSwitch('intFB', ()=>settings.integrations.FB, v=>settings.integrations.FB=v);
  bindSwitch('intX',  ()=>settings.integrations.X,  v=>settings.integrations.X=v);
  bindSwitch('intLI', ()=>settings.integrations.LI, v=>settings.integrations.LI=v);

  // data: export/import/reset
  document.getElementById('btnExport')?.addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify({
      settings, profile, db, campaigns, campSort
    }, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'phasee-export.json';
    a.click();
  });

  document.getElementById('fileImport')?.addEventListener('change', (e)=>{
    const f = e.target.files?.[0]; if(!f) return;
    const r = new FileReader();
    r.onload = ()=>{
      try{
        const obj = JSON.parse(r.result);
        if (obj.settings) { settings = obj.settings; saveLS(SETTINGS_KEY, settings); }
        if (obj.profile)  { profile  = obj.profile;  saveLS(PROFILE_KEY, profile); }
        if (obj.db)       { db       = obj.db;       saveLS(DB_KEY, db); }
        if (obj.campaigns){ campaigns= obj.campaigns;saveLS(CAMPAIGNS_KEY, campaigns); }
        if (obj.campSort) { campSort = obj.campSort; saveLS(CAMP_SORT_KEY, campSort); }
        // reapply
        applySettingsEffects();
        yearOptions(); loadProfileUI();
        buildCalendar(view.y, view.m);
        updateCampScheduled(); applyCampSortIndicators(); renderCampaignRows();
        alert('Import complete.');
      }catch(err){ alert('Import failed: '+err?.message); }
    };
    r.readAsText(f);
  });

  document.getElementById('btnReset')?.addEventListener('click', ()=>{
    if (!confirm('Reset all app data? This clears localStorage for Phasee.')) return;
    try{
      localStorage.removeItem(SETTINGS_KEY);
      localStorage.removeItem(PROFILE_KEY);
      localStorage.removeItem(DB_KEY);
      localStorage.removeItem(CAMPAIGNS_KEY);
      localStorage.removeItem(CAMP_SORT_KEY);
      location.reload();
    }catch{}
  });
}

// map a column key to a comparable value
function campValue(c, key){
  switch(key){
    case 'name':      return (c.name||'').toLowerCase();
    case 'objective': return (c.objective||'').toLowerCase();
    case 'range':     return (c.start||'') + '|' + (c.end||'');       // sort by start then end
    case 'posts':     return Number(c.posts||0);
    case 'status':    return (c.status||'').toLowerCase();
    case 'platforms': return (c.platforms||[]).join(',').toLowerCase();
    case 'tone':      return (c.tone||'').toLowerCase();
    case 'notes':     return (c.notes||'').toLowerCase();
    default:          return '';
  }
}

function sortedCampaigns(){
  const {key, dir} = campSort;
  const list = [...campaigns];
  list.sort((a,b)=>{
    const av = campValue(a,key), bv = campValue(b,key);
    if (av < bv) return dir==='asc' ? -1 :  1;
    if (av > bv) return dir==='asc' ?  1 : -1;
    return 0;
  });
  return list;
}
// ---- pretty date range helpers ----
const dateFmt = new Intl.DateTimeFormat(undefined, { month:'short', day:'numeric', year:'numeric' });

function updateCampScheduled(){
  const el = document.getElementById('campScheduled');
  if (!el) return;
  el.textContent = `${campaigns.length} Scheduled`;
}

// flip arrows (via aria-sort)
function applyCampSortIndicators(){
  document.querySelectorAll('.campaign-table .camp-head .camp-col').forEach(h=>{
    h.removeAttribute('aria-sort');
  });
  const active = document.querySelector(`.campaign-table .camp-head .camp-col[data-key="${campSort.key}"]`);
  if (active) active.setAttribute('aria-sort', campSort.dir);
}
/* ======= Campaign helpers (dates & display) ======= */
function formatDate(iso){
  if (!iso) return '‚Äî';
  const d = new Date(iso);
  if (Number.isNaN(d)) return '‚Äî';
  return d.toLocaleDateString(undefined, { month:'short', day:'numeric', year:'numeric' });
}
function formatRange(startISO, endISO){
  if (!startISO && !endISO) return '‚Äî';
  if (startISO && endISO) return `${formatDate(startISO)} \u2013 ${formatDate(endISO)}`;
  return formatDate(startISO || endISO);
}
function daysBetween(startISO, endISO){
  if (!startISO || !endISO) return '‚Äî';
  const s = new Date(startISO), e = new Date(endISO);
  if (Number.isNaN(s) || Number.isNaN(e)) return '‚Äî';
  // inclusive day count; change +1 to +0 if you prefer exclusive
  const ms = e.setHours(12,0,0,0) - s.setHours(12,0,0,0);
  return Math.max(1, Math.round(ms / 86400000) + 1);
}
function postsSlashDays(c){
  const d = daysBetween(c.start, c.end);
  if (d === '‚Äî') return (c.posts ?? '‚Äî');
  return `${(c.posts ?? 0)}/${d}`;
}
function niceStatus(s){
  s = (s || '').toLowerCase();
  if (s === 'planned' || s === 'queued') return 'Queued';
  if (s === 'active') return 'Active';
  if (['finished','complete','completed','done'].includes(s)) return 'Finished';
  return (s || '').charAt(0).toUpperCase() + (s || '').slice(1);
}

// dump rows into #campBody
function renderCampaignRows(){
  const list = document.getElementById('campList');   // << use the new container
  if (!list) return;
  list.innerHTML = '';

  const rows = sortedCampaigns();
  if (!rows.length) return;

  rows.forEach(c=>{
    const card = document.createElement('div');
    card.className = 'camp-card';
   const niceStatus = (s) => {
  s = (s||'').toLowerCase();
  if (s === 'planned' || s === 'queued') return 'Queued';
  if (s === 'active') return 'Active';
  if (s === 'finished' || s === 'complete' || s === 'completed' || s === 'done') return 'Finished';
  return (s || '').charAt(0).toUpperCase() + (s || '').slice(1);
};

card.innerHTML = `
  <div class="camp-cell" data-key="name">${c.name || ''}</div>
  <div class="camp-cell" data-key="objective">${c.objective || ''}</div>
  <div class="camp-cell" data-key="range">${formatRange(c.start, c.end)}</div>
  <div class="camp-cell" data-key="posts">${postsSlashDays(c)}</div>
  <div class="camp-cell" data-key="status">${niceStatus(c.status)}</div>
  <div class="camp-cell" data-key="platforms">${(c.platforms || []).join(', ')}</div>
  <div class="camp-cell" data-key="tone">${c.tone || ''}</div>
  <div class="camp-cell" data-key="notes">${c.notes || ''}</div>
`;


    list.appendChild(card);
  });
}

function wireCampaignSortClicks(){
  document
    .querySelectorAll('.campaign-table .camp-head .camp-col')
    .forEach(h=>{
      const key = h.getAttribute('data-key');
      if (!key) return;
      h.classList.add('sortable');
      h.addEventListener('click', ()=>{
        if (campSort.key === key){
          campSort.dir = (campSort.dir === 'asc' ? 'desc' : 'asc');
        } else {
          campSort.key = key;
          campSort.dir = 'asc';
        }
        saveLS(CAMP_SORT_KEY, campSort);
        applyCampSortIndicators();
        renderCampaignRows();
      });
    });
}
/* ===================== Settings Stage Rendering ===================== */
const stage = document.getElementById('settingsStage');

function renderSettingsView(view = 'account'){
  if (!stage) return;
  // ensure current link looks active-ish
  document.querySelectorAll('.settings-list a').forEach(a => a.classList.remove('active'));
  ({
    account:'#setAccount',
    integrations:'#setIntegrations',
    subscription:'#setSubscription',
    logout:'#setLogout',
    help:'#setHelp'
  }[view] && document.querySelector({
    account:'#setAccount',
    integrations:'#setIntegrations',
    subscription:'#setSubscription',
    logout:'#setLogout',
    help:'#setHelp'
  }[view])?.classList.add('active'));

  // ‚Äî‚Äî‚Äî Account ‚Äî‚Äî‚Äî
  if (view === 'account'){
    if (!settings.account?.loggedIn){
      stage.innerHTML = `
        <div class="stage-row">
          <div class="stage-card">
            <h3 class="stage-title">Log in</h3>
            <div class="stage-help">Use any email + password (demo only).</div>
            <div class="stage-row" style="grid-template-columns:1fr;">
              <input id="accEmail" class="select-sm" placeholder="Email" type="email" />
              <input id="accPass" class="select-sm" placeholder="Password" type="password" />
              <button id="btnLogin" class="stage-btn primary">Log in</button>
            </div>
          </div>
        </div>
      `;
      document.getElementById('btnLogin')?.addEventListener('click', ()=>{
        const email = (document.getElementById('accEmail')?.value||'').trim();
        const pass  = (document.getElementById('accPass')?.value||'').trim();
        if (!email || !pass){ alert('Enter email and password.'); return; }
        settings.account = { loggedIn:true, email };
        saveLS(SETTINGS_KEY, settings);
        renderSettingsView('account');
      });
      return;
    }
    // logged in
    stage.innerHTML = `
      <div class="stage-row">
        <div class="stage-card">
          <h3 class="stage-title">Account</h3>
          <div><strong>Email:</strong> ${settings.account.email}</div>
          <div class="stage-help">Demo UI ‚Äì no real auth.</div>
          <div style="margin-top:10px;">
            <button id="btnChangePassword" class="stage-btn">Change password</button>
            <button id="btnLogout" class="stage-btn" style="margin-left:8px;">Log out</button>
          </div>
        </div>
      </div>
    `;
    document.getElementById('btnChangePassword')?.addEventListener('click', ()=> alert('Pretend password flow‚Ä¶'));
    document.getElementById('btnLogout')?.addEventListener('click', ()=>{
      settings.account = {loggedIn:false, email:''};
      saveLS(SETTINGS_KEY, settings);
      renderSettingsView('account');
    });
    return;
  }

  // ‚Äî‚Äî‚Äî Subscription ‚Äî‚Äî‚Äî
  if (view === 'subscription'){
    stage.innerHTML = `
      <div class="stage-row">
        <div class="stage-card">
          <h3 class="stage-title">Choose your plan</h3>
          <div class="stage-help">Press a plan to switch immediately (demo).</div>
          <div class="plan-grid">
            <div class="plan ${settings.plan==='free'?'selected':''}" data-plan="free">
              <h3>Free Trial</h3>
              <div class="price">$0</div>
              <div class="meta">1-week trial</div>
              <button class="stage-btn choose">Start Free Trial</button>
            </div>
            <div class="plan ${settings.plan==='core'?'selected':''}" data-plan="core">
              <h3>Core</h3>
              <div class="price">$9</div>
              <div class="meta">7-day Core access</div>
              <button class="stage-btn choose">Choose Core</button>
            </div>
            <div class="plan ${settings.plan==='pro'?'selected':''}" data-plan="pro">
              <h3>Pro</h3>
              <div class="price">$29</div>
              <div class="meta">30-day Pro access</div>
              <button class="stage-btn choose">Choose Pro</button>
            </div>
          </div>
          <div style="margin-top:10px;">
            Current plan: <strong id="planNow">${settings.plan.toUpperCase()}</strong>
          </div>
        </div>
      </div>
    `;
    stage.querySelectorAll('.plan .choose').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const p = btn.closest('.plan')?.dataset.plan || 'free';
        settings.plan = p;
        saveLS(SETTINGS_KEY, settings);
        renderSettingsView('subscription');
        alert('Plan changed to: '+p.toUpperCase());
      });
    });
    return;
  }

  // ‚Äî‚Äî‚Äî Integrations ‚Äî‚Äî‚Äî
  if (view === 'integrations'){
    const I = settings.integrations || {};
    stage.innerHTML = `
      <div class="stage-row">
        <div class="stage-card">
          <h3 class="stage-title">Integrations</h3>
          <div class="stage-help">Toggle on/off and use Connect to open the provider portal (placeholder).</div>

          <div class="int-row" data-k="Instagram">
            <div class="int-name">Instagram</div>
            <div class="int-actions">
              <button class="stage-btn" data-connect>Connect</button>
              <div class="switch-min" data-toggle aria-label="Instagram on/off" data-on="${!!I.Instagram}"><i></i></div>
            </div>
          </div>

          <div class="int-row" data-k="Facebook">
            <div class="int-name">Facebook</div>
            <div class="int-actions">
              <button class="stage-btn" data-connect>Connect</button>
              <div class="switch-min" data-toggle aria-label="Facebook on/off" data-on="${!!I.Facebook}"><i></i></div>
            </div>
          </div>

          <div class="int-row" data-k="X">
            <div class="int-name">X</div>
            <div class="int-actions">
              <button class="stage-btn" data-connect>Connect</button>
              <div class="switch-min" data-toggle aria-label="X on/off" data-on="${!!I.X}"><i></i></div>
            </div>
          </div>

                   <div class="int-row" data-k="TikTok">
            <div class="int-name">TikTok</div>
            <div class="int-actions">
              <button class="stage-btn" data-connect>Connect</button>
              <div class="switch-min" data-toggle aria-label="TikTok on/off" data-on="${!!I.TikTok}"><i></i></div>
            </div>
          </div>
        </div> <!-- .stage-card -->
      </div>   <!-- .stage-row -->
    `;


    // Connect buttons (placeholder auth links)
    stage.querySelectorAll('[data-connect]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const row = btn.closest('.int-row'); const k = row?.dataset.k;
        alert(`Open ${k} login‚Ä¶ (placeholder)`);
        // window.open('https://provider-login.example', '_blank'); // later
      });
    });

    // On/off toggles
    stage.querySelectorAll('[data-toggle]').forEach(sw=>{
      sw.addEventListener('click', ()=>{
        const row = sw.closest('.int-row'); const k = row?.dataset.k;
        const newVal = sw.getAttribute('data-on') !== 'true';
        sw.setAttribute('data-on', newVal ? 'true' : 'false');
        settings.integrations[k] = newVal;
        saveLS(SETTINGS_KEY, settings);
      });
    });
    return;
  }

  // ‚Äî‚Äî‚Äî Log Out (shortcut) ‚Äî‚Äî‚Äî
  if (view === 'logout'){
    if (!settings.account?.loggedIn){
      stage.innerHTML = `<div class="stage-card"><div class="stage-title">You‚Äôre not logged in.</div></div>`;
    } else {
      settings.account = {loggedIn:false, email:''};
      saveLS(SETTINGS_KEY, settings);
      stage.innerHTML = `<div class="stage-card"><div class="stage-title">Logged out.</div></div>`;
    }
    return;
  }

  // ‚Äî‚Äî‚Äî Help ‚Äî‚Äî‚Äî
  if (view === 'help'){
    stage.innerHTML = `
      <div class="stage-card">
        <h3 class="stage-title">Help</h3>
        <div class="stage-help">This is a demo Settings area. Each tile is self-contained and uses localStorage.</div>
      </div>
    `;
    return;
  }
}

// Left menu routing
document.getElementById('setAccount')?.addEventListener('click', ()=> renderSettingsView('account'));
document.getElementById('setIntegrations')?.addEventListener('click', ()=> renderSettingsView('integrations'));
document.getElementById('setSubscription')?.addEventListener('click', ()=> renderSettingsView('subscription'));
document.getElementById('setLogout')?.addEventListener('click', ()=> renderSettingsView('logout'));
document.getElementById('setHelp')?.addEventListener('click', ()=> renderSettingsView('help'));

// Jump helper (re-use/replace your existing function if you added one earlier)
function goToSettingsSection(which='subscription'){
  showPage('settings');
  renderSettingsView(which);
  requestAnimationFrame(()=>{
    const map = {
      subscription: '#setSubscription',
      account: '#setAccount',
      integrations: '#setIntegrations',
      logout: '#setLogout',
      help: '#setHelp'
    };
    const el = document.querySelector(map[which] || map.subscription);
    if (!el) return;
    el.scrollIntoView({behavior:'smooth', block:'nearest'});
    el.classList.add('pulse'); el.focus?.();
    setTimeout(()=> el.classList.remove('pulse'), 1200);
  });
}

// Keep your previous wiring for the Upgrade button (or add this if missing):
document.getElementById('upgradeBtn')?.addEventListener('click', ()=> goToSettingsSection('subscription'));

/* ======= INIT ======= */
document.documentElement.setAttribute('data-theme', settings.theme||'day');
renderViewBy();
buildCalendar(view.y, view.m);

yearOptions();
loadProfileUI();
// default to Calendar page (as requested)
// Scroll the week that contains "today" to the top of the viewport



document.getElementById('btnNewCampaign')?.addEventListener('click', ()=>{
  alert('New Campaign ‚Äî modal coming soon');
});
// Scroll the week that contains "today" to the top of the viewport


// Upgrade Plan ‚Üí take user to Settings and highlight Subscription
document.getElementById('upgradeBtn')?.addEventListener('click', (e)=>{
  e.preventDefault();
  showPage('settings');

  // flash the Subscription link so it‚Äôs obvious
  const sub = document.getElementById('setSubscription');
  if (sub) {
    sub.classList.add('pulse');
    setTimeout(()=> sub.classList.remove('pulse'), 1600);
  }

  // placeholder action (replace with your real flow or a pricing URL)
  // window.open('https://your-pricing-url.example', '_blank');
});

// === Campaigns init on load (must be outside the click handler) ===
updateCampScheduled();
applyCampSortIndicators();
renderCampaignRows();
wireCampaignSortClicks();


showPage('calendar');
/* === Campaigns: column resizer (fills width; saves to localStorage) === */
(() => {
  const table = document.querySelector('.campaign-table');
  const head  = table?.querySelector('.camp-head');
  if (!table || !head) return;

  const STORAGE_KEY = 'campaigns.colwidths.v2';
  // map header data-key -> CSS var name
  const keyToVar = {
    name:'--c-name',
    objective:'--c-objective',
    range:'--c-range',
    posts:'--c-posts',
    status:'--c-status',
    platforms:'--c-platforms',
    tone:'--c-tone',
    notes:'--c-notes'
  };
// If user opens Settings, render the default view (Account)
document.getElementById('openSettings')?.addEventListener('click', ()=>{
  showPage('settings');
  renderSettingsView('account');
});

  // 1) Restore any saved widths
  try {
    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    for (const [k, px] of Object.entries(saved)) {
      const v = keyToVar[k];
      if (v && px) table.style.setProperty(v, px + 'px');
    }
  } catch {}

  // 2) Drag logic
  let drag = null;
  head.querySelectorAll('.camp-col').forEach(col => {
    const key  = col.getAttribute('data-key');
    const grip = col.querySelector('.col-grip');
    if (!key || !grip || !keyToVar[key]) return;

    grip.addEventListener('mousedown', e => {
      e.preventDefault();
      const rect = col.getBoundingClientRect();
      const current =
        parseFloat(getComputedStyle(table).getPropertyValue(keyToVar[key])) || rect.width;
      drag = { key, startX: e.clientX, startW: current };
      document.body.style.cursor = 'col-resize';
    });
  });

  const onMove = e => {
    if (!drag) return;
    const w = Math.max(100, Math.round(drag.startW + (e.clientX - drag.startX)));
    table.style.setProperty(keyToVar[drag.key], w + 'px');
  };
  const onUp = () => {
    if (!drag) return;
    document.body.style.cursor = '';
    // collect current px values
    const out = {};
    for (const [k, v] of Object.entries(keyToVar)) {
      const val = parseFloat(getComputedStyle(table).getPropertyValue(v));
      if (val) out[k] = Math.round(val);
    }
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(out)); } catch {}
    drag = null;
  };
// ===== Compose modal: close / cancel / esc / backdrop =====
// --- Compose: close on backdrop, Cancel, or Esc ---
function closeCompose(){ document.getElementById('composeWrap')?.classList.remove('open'); }

document.getElementById('composeCancel')?.addEventListener('click', e => {
  e.preventDefault(); closeCompose();
});

document.getElementById('composeWrap')?.addEventListener('click', e => {
  // only close if the click is on the dark backdrop, not inside the card
  if (e.target === e.currentTarget) closeCompose();
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeCompose();
});

document.getElementById('composeSave')?.addEventListener('click', e => {
  e.preventDefault();

  // must have a date; openCompose(iso) sets this
  if (!composeISO) {
    alert('No date selected. Click + on a day to pick a date.');
    return;
  }

  // gather form fields
  const content = document.getElementById('cmpContent')?.value.trim() || '';
  const copy    = document.getElementById('cmpCopy')?.value.trim() || '';
  const time    = document.getElementById('cmpTime')?.value || '9:00 AM';

  // exactly ONE platform (radio-style). If you haven‚Äôt wired single-select yet, this will still work by taking the first ‚Äúon‚Äù.
  const active = document
    .getElementById('cmpPlatWrap')
    ?.querySelector('.pill-chip[data-on="true"]');

  if (!active) { alert('Choose a platform.'); return; }
  const platform = active.textContent.trim();

  // write to localStorage DB
  db[composeISO] = db[composeISO] || [];
  db[composeISO].push({
    platform,
    title: copy || content || 'Untitled',
    time,
    content,
    copy,
    media: composeMedia || null
  });

  saveLS(DB_KEY, db);

  // refresh the 31-day calendar and close the modal
  buildCalendar();   // args ignored; function anchors to today
  closeCompose();
});


  window.addEventListener('mousemove', onMove);
  window.addEventListener('mouseup', onUp);
  window.addEventListener('mouseleave', onUp);
})();


</script>
<!-- Compose Modal -->
<div id="composeWrap" class="compose-backdrop" aria-modal="true" role="dialog">
  <div class="compose-card" role="document">
    <h3 class="compose-title">Compose Post</h3>

    <div class="c-row two">
      <div class="c-input-wrap">
        <input id="cmpContent" class="c-input" placeholder="Content (e.g., DTC skincare)" />
        <button id="aiContent" class="ai-in-input" type="button">AI</button>
      </div>
      <button id="uploadBtn" class="ai-btn" type="button">Upload</button>
    </div>

    <input id="cmpUpload" type="file" accept="image/*,video/*" hidden>
    <div id="uploadMeta" class="small-help"></div>

    <div class="c-row">
      <input id="cmpCopy" class="c-input" placeholder="Copy (caption / title)" />
      <button id="aiCopy" class="ai-btn" type="button">AI</button>
    </div>

    <div class="c-inline">
      <label for="cmpTime" style="font-weight:800;">Time</label>
      <select id="cmpTime" class="c-select"></select>
    </div>

    <div class="c-inline" style="flex-wrap:wrap;">
      <div style="font-weight:800;">Platforms</div>
      <div id="cmpPlatWrap" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
    </div>

    <div class="compose-actions">
      <button id="composeCancel" class="btn-ghost">Cancel</button>
      <button id="composeSave" class="btn-primary">Schedule</button>
    </div>

    <div class="small-help" id="composeDateHelp"></div>
  </div>
</div>


</div>     <!-- .wrap (close once, at the very end) -->
</section> <!-- .main -->
</div>     <!-- .app -->
</body>
</html>
