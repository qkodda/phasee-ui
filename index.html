<!doctype html>
<html lang="en" data-theme="day">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Phasee ¬∑ Plan ahead. Stay ahead.</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
.campaign-shell{ max-width:100%; }
.camp-table{
  overflow-x:hidden;          /* no horizontal scroll */
  position:relative;          /* ensure CSS vars resolve consistently */
}


/* ===================== THEME + TOKENS ===================== */
:root{
  --font: 14.5px/1.55 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  --radius-lg:16px; --radius:12px; --radius-sm:9px;
  --shadow-1: 0 6px 18px rgba(20,25,38,.06);
  --shadow-2: 0 14px 30px rgba(20,25,38,.10);

  /* brand / accents */
  --accent:#7A70F5;             /* primary lavender */
  --accent-2:#FF8A3D;           /* vibrant orange for pop/hover */
  --plus:#49D07E;               /* friendly green plus */
  --plus-glow: rgba(73,208,126,.22);

  /* day */
  --bg: #F7F8FC;
  --panel: #ffffff;
  --panel-2: #FAFBFF;
  --ring:#E7EAF5;
  --ink:#0f172a;
  --muted:#6b7280;
  --chip:#EEF0FF; --chip-b:#DADFFF;
}
[data-theme="night"]{
  --bg: #0E1220;
  --panel:#141A2B;
  --panel-2:#11182A;
  -objectiive-ring:#1D2740;
  --ink:#E7ECF8;
  --muted:#9AA6C0;
  --chip:#1A2140; --chip-b:#2A335C;
}

/* ===================== LAYOUT SHELL ===================== */
*{box-sizing:border-box}
html,body{margin:0;height:100%}
body{font:var(--font); color:var(--ink); background:
  radial-gradient(1400px 700px at 20% -10%, #F1F3FF 0%, var(--bg) 38%, var(--bg) 100%);}

a{color:inherit; text-decoration:none}
button{font:inherit}

.app{
  display:grid; grid-template-columns: 220px 1fr; min-height:100dvh;
}

/* ===================== SIDEBAR ===================== */
.side{
  position:sticky; top:0; height:100dvh; padding:18px 12px 16px;
  background:linear-gradient(180deg, var(--panel), var(--panel-2));
  border-right:1px solid var(--ring);
  display:flex; flex-direction:column; gap:10px; z-index:5;
}
.brand{display:flex; align-items:center; gap:10px; padding:6px 8px}
.logo{width:26px;height:26px;border-radius:8px;
  background:linear-gradient(135deg,var(--accent),color-mix(in oklab,var(--accent-2) 65%, #fff 35%));
  box-shadow:0 8px 18px color-mix(in oklab, var(--accent) 42%, transparent);
}
.brandname{font-weight:900; font-size:22px}

.nav{display:grid; gap:6px; margin-top:8px}
.nav a{
  display:flex; align-items:center; gap:10px;
  padding:10px; border-radius:12px; font-weight:800; border:1px solid transparent;
}
.nav a[data-active="true"], .nav a:hover{
  background:var(--panel-2); border-color:var(--ring)
}

/* Settings block at bottom */
.side .foot{margin-top:auto; display:grid; gap:8px; padding:8px}
.settings-link{
  font-weight:800; cursor:pointer; width:max-content;
  padding:8px 10px; border-radius:12px;
}
.settings-link:hover{background:var(--panel-2); border:1px solid var(--ring)}
.plan-wrap{display:grid; gap:6px; margin-top:2px}
.plan-name{font-size:12px; color:var(--muted); text-align:center}
.upgrade{
  justify-self:center;
  border:1px solid transparent; color:#fff; font-weight:900;
  background:linear-gradient(135deg, var(--accent-2), color-mix(in oklab, var(--accent-2) 85%, #ffd7bf 15%));
  padding:8px 12px; border-radius:12px; box-shadow:0 10px 20px rgba(255,138,61,.18);
}
.upgrade:hover{filter:brightness(1.03)}

/* ===================== TOP BAR ===================== */
.main{display:grid; grid-template-rows:62px 1fr}
.top{
  background:linear-gradient(180deg, var(--panel), color-mix(in srgb, var(--panel-2) 60%, var(--panel) 40%));
  border-bottom:1px solid var(--ring); padding:0 16px;
  display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:4;
}
.monthbar{display:flex; align-items:center; gap:8px}
.monthbtn{appearance:none; border:1px solid var(--ring); background:var(--panel); border-radius:12px; padding:6px 10px; font-weight:800; cursor:pointer}
.monthlabel{font-weight:900; font-size:18px}

.controls{display:flex; align-items:center; gap:10px; position:relative}
.iconbtn{appearance:none; border:1px solid var(--ring); background:var(--panel); border-radius:12px; padding:6px 10px; cursor:pointer; font-weight:800}

/* View-by dropdown */
.dropdown{
  position:absolute; right:0; top:40px; min-width:240px;
  background:var(--panel); border:1px solid var(--ring); border-radius:12px;
  box-shadow:var(--shadow-2); padding:10px; display:none; z-index:10;
}
.dropdown.open{display:block}
.drop-row{display:flex; align-items:center; gap:8px; padding:6px 4px; border-radius:8px}
.drop-row:hover{background:var(--panel-2)}
.pill{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; font-weight:900; border-radius:999px; border:1px solid var(--ring)}
.pill .dot{width:8px;height:8px;border-radius:50%}

/* ===================== CALENDAR ===================== */
.page{display:none}
.page.active{display:block}
.wrap{padding:16px}

.calendar{background:var(--panel); border:1px solid var(--ring); border-radius:var(--radius-lg); box-shadow:var(--shadow-2); padding:10px}
.weeks{display:grid; grid-template-columns:repeat(7,1fr); gap:6px; padding:0 6px 4px; color:#8791a7; font-weight:900; font-size:11px}
.grid{display:grid; grid-template-columns:repeat(7,1fr); gap:6px}
.day{
  background:var(--panel); border:1px solid var(--ring); border-radius:14px; padding:10px; min-height:110px;
  display:grid; grid-template-rows:auto 1fr; gap:6px; position:relative; box-shadow:var(--shadow-1);
  transition:transform .08s ease, box-shadow .15s ease, border-color .12s ease;
}
.day:hover{transform:translateY(-1px); box-shadow:0 16px 36px rgba(15, 23, 42, .12); border-color: color-mix(in oklab, var(--accent-2) 30%, var(--ring))}
.day.selected{outline:2px solid color-mix(in oklab, var(--accent-2) 32%, transparent); outline-offset:2px}
.dhead{display:flex; align-items:center; justify-content:space-between}
.dnum{font-weight:900; font-size:11px}
.plus{
  width:26px; height:26px; display:grid; place-items:center; border-radius:9px; border:0; cursor:pointer;
  color:#03522A; font-weight:900; font-size:16px; line-height:0;
  background: radial-gradient(14px 14px at 50% 50%, #9CF4C5 0%, var(--plus) 65%, var(--plus) 100%);
  box-shadow: 0 0 0 6px var(--plus-glow);
  transition: transform .05s ease;
}
.plus:active{transform:translateY(.4px)}
.empty{opacity:.65; color:#97a0b3; font-size:11px}
.card{
  display:flex; align-items:center; gap:6px; padding:6px 8px;
  border-radius:10px; border:1px solid rgba(0,0,0,.05);
  box-shadow:0 6px 14px rgba(15,23,42,.07);
}
.card .pip{width:22px; height:22px; border-radius:7px; display:grid; place-items:center; color:#1d2435; font-size:12px; font-weight:900}
.timechip{margin-left:auto; font-weight:900; padding:2px 7px; border-radius:999px; background:rgba(255,255,255,.9); border:1px solid rgba(0,0,0,.05); font-size:10px}

/* platform colors */
.p-ig{background:#FFB7DA}
.p-fb{background:#BFD0FF}
.p-x{background:#CFD7E7}
.p-yt{background:#FFB8C0}
.p-tt{background:#FFD57A}
.p-bl{background:#BFE9CF}
.p-web{background:#FFC7AE}

/* ===================== PROFILE (mock-exact) ===================== */
.profile-card{
  max-width: 760px;
  background:var(--panel); border:1px solid var(--ring);
  border-radius:var(--radius-lg); box-shadow:var(--shadow-2);
  padding:16px 16px 18px; margin-top:12px;
}
.h2{font-weight:900; margin:0 0 8px 0}
.row{display:grid; grid-template-columns: 1fr 260px; gap:16px; align-items:start}
.input, .select, textarea{
  width:100%; padding:10px 12px; border:1px solid var(--ring); border-radius:12px; background:var(--panel); color:var(--ink); outline:none;
}
.input::placeholder, textarea::placeholder{color:#9aa3b2}
.input:focus, .select:focus, textarea:focus{border-color:color-mix(in oklab, var(--accent) 40%, var(--ring))}
.lab{font-size:12px; color:#7683a1; font-weight:800; margin:10px 0 6px}
.logoBox{
  width:120px; height:120px; border:1px dashed var(--ring); border-radius:12px; background:var(--panel-2);
  background-size:cover; background-position:center; margin-bottom:8px;
}
.link-add{display:inline-block; font-weight:800; color:#5c63d6; cursor:pointer; margin-top:6px}
.link-add:hover{text-decoration:underline}
.link-row{display:flex; gap:8px; margin-top:6px}
.savebar{display:flex; justify-content:flex-end; margin-top:12px}
.savebtn{
  border:1px solid transparent; color:#fff; font-weight:900; background:linear-gradient(135deg, var(--accent), color-mix(in oklab, var(--accent-2) 60%, #fff 40%));
  padding:10px 14px; border-radius:12px; box-shadow:0 10px 20px rgba(122,112,245,.2); cursor:pointer;
}

/* ===================== CAMPAIGNS + ANALYTICS placeholders ===================== */
.card{background:var(--panel)}

/* ===================== RESPONSIVE ===================== */
@media (max-width:1000px){
  .app{grid-template-columns:78px 1fr}
  .brandname{display:none}
  .row{grid-template-columns:1fr}
}
</style>  <!-- ‚Üê add this line -->

<style id="campaigns-v2">
/* ==== Header card (matches your mock) ==== */
.campaign-header{
  display:flex; align-items:center; gap:12px;
  padding:14px 18px; margin-bottom:12px;
  background:var(--panel); border:1px solid var(--ring);
  border-radius:var(--radius-lg); box-shadow:var(--shadow-2);
}
.campaign-header .title{ margin:0; font-size:20px; font-weight:800; }
.campaign-header .meta{
  margin-left:auto; margin-right:12px;
  font-size:13px; font-weight:700; color:var(--muted);
}
.campaign-header .btn.primary{
  border:0; color:#fff; font-weight:900;
  padding:8px 14px; border-radius:12px; cursor:pointer;
  background:linear-gradient(135deg, var(--accent), var(--accent-2));
  box-shadow:0 8px 16px rgba(0,0,0,.12);
}
.campaign-header .btn.primary:hover{ filter:brightness(1.05); }

/* ==== Table card ==== */
.campaign-table{
  background:var(--panel); border:1px solid var(--ring);
  border-radius:var(--radius-lg); box-shadow:var(--shadow-1);
  overflow:hidden;
}

/* Columns ‚Äì clean fixed grid */
.camp-row{
  display:grid;
  grid-template-columns: 1.2fr 1.2fr 1fr 1fr 1fr 1.2fr 1fr 1.2fr;
  align-items:center; padding:10px 16px;
}
.camp-row.camp-head{
  font-size:13px; font-weight:900; text-transform:uppercase;
  border-bottom:1px solid var(--ring);
}
.camp-col + .camp-col{
  border-left:1px solid rgba(15,23,42,.06);
  padding-left:12px;
}

/* Hover for future body rows */
.camp-body .camp-row:hover{
  background:color-mix(in oklab, var(--panel-2) 40%, transparent);
}

/* Responsive trims */
@media (max-width:1200px){
  .camp-row{ grid-template-columns: 1.3fr 1.1fr 1fr 0.9fr 0.9fr 1.1fr 0.9fr 1.1fr; }
}
@media (max-width:980px){
  .campaign-table .camp-row .camp-col:nth-child(8){ display:none; } /* hide Additional */
  .camp-row{ grid-template-columns: 1.4fr 1.1fr 1fr 1fr 1fr 1.1fr 1fr; }
}/* === Fill full width with CSS vars per column (defaults are fr) === */
.campaign-table .camp-row{
  display:grid;
  grid-template-columns:
    minmax(140px, var(--c-name, 1.25fr))
    minmax(120px, var(--c-objective, 1.15fr))
    minmax(140px, var(--c-range, 1.1fr))
    minmax(120px, var(--c-posts, 1fr))
    minmax(110px, var(--c-status, 1fr))
    minmax(140px, var(--c-platforms, 1.15fr))
    minmax(110px, var(--c-tone, 0.95fr))
    minmax(140px, var(--c-notes, 1.1fr));
  align-items:center;
  padding:10px 16px;
}

/* Header look */
.campaign-table .camp-row.camp-head{
  font-size:13px; font-weight:900; text-transform:uppercase;
  border-bottom:1px solid var(--ring);
}

/* Cell separators */
.campaign-table .camp-col + .camp-col{
  border-left:1px solid rgba(15,23,42,.06);
  padding-left:12px;
}

/* === Resize grip === */
.campaign-table .camp-head .camp-col{ position:relative; }
.campaign-table .col-grip{
  position:absolute; top:0; right:-6px; width:12px; height:100%;
  cursor:col-resize; border-right:2px solid transparent;
}
.campaign-table .col-grip:hover{ border-right-color:rgba(15,23,42,.2); }

/* Hover for future body rows */
.camp-body .camp-row:hover{
  background:color-mix(in oklab, var(--panel-2) 40%, transparent);
}

/* Responsive trims */
@media (max-width:1200px){
  .campaign-table .camp-row{
    grid-template-columns:
      minmax(140px, var(--c-name, 1.35fr))
      minmax(120px, var(--c-objective, 1.1fr))
      minmax(140px, var(--c-range, 1.1fr))
      minmax(120px, var(--c-posts, 1fr))
      minmax(110px, var(--c-status, 0.95fr))
      minmax(140px, var(--c-platforms, 1.1fr))
      minmax(110px, var(--c-tone, 0.9fr))
      minmax(140px, var(--c-notes, 1.05fr));
  }
}
@media (max-width:980px){
  .campaign-table .camp-row .camp-col[data-key="notes"]{ display:none; }
  .campaign-table .camp-row{
    grid-template-columns:
      minmax(140px, var(--c-name, 1.5fr))
      minmax(120px, var(--c-objective, 1.1fr))
      minmax(140px, var(--c-range, 1.2fr))
      minmax(120px, var(--c-posts, 1fr))
      minmax(110px, var(--c-status, 1fr))
      minmax(140px, var(--c-platforms, 1.1fr))
      minmax(110px, var(--c-tone, 1fr));
  }
}
/* ---- sortable headers ---- */
.campaign-table .camp-head .camp-col {
  cursor: default;
  user-select: none;
}
.campaign-table .camp-head .camp-col.sortable {
  cursor: pointer;
}
.campaign-table .camp-head .camp-col.sortable:hover {
  text-decoration: underline;
}

/* ---- little arrow driven by aria-sort on the header ---- */
.campaign-table .camp-head .camp-col::after {
  content: ""; display:inline-block; width:12px; margin-left:6px;
}
.campaign-table .camp-head .camp-col[aria-sort="asc"]::after  { content:"‚ñ≤"; font-size:10px; }
.campaign-table .camp-head .camp-col[aria-sort="desc"]::after { content:"‚ñº"; font-size:10px; }
/* kill the header-row divider */
.campaign-table .camp-row.camp-head{
  border-bottom: 0 !important;
}

</style>

</head>
<body>

<div class="app">
  <!-- SIDEBAR -->
  <aside class="side">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="brandname">Phasee</div>
    </div>

    <nav class="nav" id="nav">
      <a href="#profile" data-page="profile"><span>Profile</span></a>
      <a href="#calendar" data-page="calendar" data-active="true"><span>Calendar</span></a>
      <a href="#campaigns" data-page="campaigns"><span>Campaigns</span></a>
      <a href="#analytics" data-page="analytics"><span>Analytics</span></a>
    </nav>

    <div class="foot">
      <a class="settings-link" id="openSettings">Settings</a>
      <div class="plan-wrap">
        <div class="plan-name" id="planName">Phasee Core</div>
        <button class="upgrade" id="upgradeBtn">Upgrade Plan</button>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <section class="main">
    <!-- TOP BAR -->
    <header class="top">
      <div class="monthbar">
        <button class="monthbtn" id="prev">‚Äπ</button>
        <div class="monthlabel" id="monthLabel">‚Äî</div>
        <button class="monthbtn" id="next">‚Ä∫</button>
      </div>
      <div class="controls">
        <button id="viewByBtn" class="iconbtn">üëÅ View by</button>
        <div class="dropdown" id="viewByMenu" aria-label="Filter platforms"></div>

        <select class="iconbtn" id="accountSel">
          <option>Acme Co</option><option>Northwind</option><option>Contoso</option>
        </select>
      </div>
    </header>

    <!-- CONTENT -->
    <div class="wrap">
      <!-- CALENDAR (default) -->
      <div class="page active" id="pageCalendar">
        <div class="calendar">
          <div class="weeks"><div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div></div>
          <div class="grid" id="grid"></div>
        </div>
      </div>

      <!-- PROFILE (mock) -->
      <div class="page" id="pageProfile">
        <div class="profile-card">
          <h2 class="h2">Profile</h2>

          <div class="row">
            <div>
              <div class="lab">Company / Brand</div>
              <input class="input" id="pName" placeholder="e.g., Acme Co">

              <div class="lab">Industry</div>
              <input class="input" id="pIndustry" placeholder="e.g., DTC skincare">

              <div class="lab">Tone / Culture</div>
              <input class="input" id="pTone" placeholder="e.g., Playful, Bold">

              <div class="lab">Founded (Year)</div>
              <select class="select" id="pYear"></select>

              <div class="lab">Motto</div>
              <input class="input" id="pMotto" placeholder="">

              <div class="lab">Bio</div>
              <textarea id="pBio" rows="3" class="input" placeholder=""></textarea>

              <div class="lab">Additional Information</div>
              <textarea id="pNotes" rows="3" class="input" placeholder="Anything that helps us build better prompts & comps"></textarea>
            </div>

            <div>
              <div class="lab">Logo / Image</div>
              <div class="logoBox" id="pLogoBox"></div>
              <input type="file" id="pLogo" accept="image/*">

              <div class="lab" style="margin-top:16px">Links</div>
              <div id="linkWrap"></div>
              <span class="link-add" id="addLink">+ Add</span>
            </div>
          </div>

          <div class="savebar">
            <button class="savebtn" id="profileSave">Save</button>
          </div>
        </div>
      </div>

      <!-- CAMPAIGNS (kept minimal; will refine later) -->
   
<section id="pageCampaigns" class="page" aria-label="Campaigns">
  <!-- Header card -->
  <div class="card campaign-header">
    <h2 class="title">Campaigns</h2>
    <div class="meta" id="campScheduled">0 Scheduled</div>
    <button id="btnNewCampaign" class="btn primary">+ Campaign</button>
  </div>

  <!-- Table card -->
  <div class="card campaign-table">
   <div class="camp-row camp-head" role="row">
  <div class="camp-col" role="columnheader" data-key="name">Name<i class="col-grip" aria-hidden="true"></i></div>
  <div class="camp-col" role="columnheader" data-key="objective">Objective<i class="col-grip" aria-hidden="true"></i></div>
  <div class="camp-col" role="columnheader" data-key="range">Start/End<i class="col-grip" aria-hidden="true"></i></div>
  <div class="camp-col" role="columnheader" data-key="posts">Posts/Days<i class="col-grip" aria-hidden="true"></i></div>
  <div class="camp-col" role="columnheader" data-key="status">Status<i class="col-grip" aria-hidden="true"></i></div>
  <div class="camp-col" role="columnheader" data-key="platforms">Platforms<i class="col-grip" aria-hidden="true"></i></div>
  <div class="camp-col" role="columnheader" data-key="tone">Tone<i class="col-grip" aria-hidden="true"></i></div>
  <div class="camp-col" role="columnheader" data-key="notes">Additional<i class="col-grip" aria-hidden="true"></i></div>
</div>
    <div id="campBody" class="camp-body" role="rowgroup"></div>
  </div>
</section>

      <!-- ANALYTICS (kept minimal; will refine later) -->
      <div class="page" id="pageAnalytics">
        <div class="profile-card">
          <h2 class="h2">Analytics</h2>
          <div>Industry / Competitors / Personal comparison cards. (Placeholder)</div>
        </div>
      </div>

      <!-- SETTINGS (navigated from bottom link) -->
      <div class="page" id="pageSettings">
        <div class="profile-card">
          <h2 class="h2">Settings</h2>
          <div class="lab">Theme</div>
          <label><input type="radio" name="theme" value="day" checked> Day</label>
          &nbsp;&nbsp;
          <label><input type="radio" name="theme" value="night"> Night</label>

          <div class="lab" style="margin-top:12px">Integrations</div>
          <div class="link-row" style="flex-wrap:wrap">
            <button class="monthbtn">Connect Instagram</button>
            <button class="monthbtn">Connect TikTok</button>
            <button class="monthbtn">Connect Facebook</button>
            <button class="monthbtn">Connect Pinterest</button>
            <button class="monthbtn">Connect X/Twitter</button>
            <button class="monthbtn">Connect LinkedIn</button>
          </div>

          <div class="lab" style="margin-top:12px">Account</div>
          <div class="link-row">
            <button class="monthbtn">Manage Account</button>
            <button class="monthbtn">Change Plan</button>
          </div>
        </div>
      </div>

    </div>
  </section>
</div>
if (!campaigns.length){
  campaigns = [
    {name:'Fall Launch', objective:'Awareness', start:'2025-09-01', end:'2025-09-30', posts:3, status:'Planned', platforms:['Instagram','TikTok'], tone:'Playful', notes:'UGC focus'},
    {name:'VIP Drop',   objective:'Conversion', start:'2025-08-15', end:'2025-08-20', posts:2, status:'Active',  platforms:['Instagram','X'],     tone:'Hype',    notes:'Limited stock'},
    {name:'Evergreen',  objective:'Retention',  start:'2025-07-01', end:'2025-12-31', posts:1, status:'Active',  platforms:['Blog','Website'],    tone:'Helpful', notes:''},
  ];
  saveLS(CAMPAIGNS_KEY, campaigns);
}

<script>
/* ======= Helpers ======= */
const $  = (sel, root=document) => root.querySelector(sel);
const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
const isoOf = (y,m,d)=> new Date(y,m,d).toISOString().slice(0,10);
function saveLS(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
function loadLS(k,fb){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):fb }catch{ return fb } }

/* ======= Storage Keys ======= */
const DB_KEY = 'phasee-db-v1';
const SETTINGS_KEY = 'phasee-settings-v1';
const FILTERS_KEY = 'phasee-filters-v1';
const PROFILE_KEY = 'phasee-profile-v1';
/* ======= Campaigns storage ======= */
const CAMPAIGNS_KEY = 'phasee-campaigns-v1';
const CAMP_SORT_KEY = 'phasee-camp-sort-v1';

let campaigns = loadLS(CAMPAIGNS_KEY, []);                     // [{name, objective, start, end, posts, status, platforms[], tone, notes}]
let campSort  = loadLS(CAMP_SORT_KEY, { key:'name', dir:'asc' }); // persisted sort {key, dir}

/* ======= State ======= */
let db = loadLS(DB_KEY, {});                 // { 'YYYY-MM-DD': [ {platform,title,time,...}, ... ] }
let filters = loadLS(FILTERS_KEY, {Instagram:true, Facebook:true, X:true, YouTube:true, TikTok:true, Blog:true, Website:true});
let settings = loadLS(SETTINGS_KEY, {theme:document.documentElement.getAttribute('data-theme')||'day'});
let profile = loadLS(PROFILE_KEY, {links:[]});

/* ======= Platforms for View-by ======= */
const PLATS = [
  {key:'Instagram', cls:'p-ig', dot:'#E8447C'},
  {key:'Facebook',  cls:'p-fb', dot:'#1877F2'},
  {key:'X',         cls:'p-x',  dot:'#111'},
  {key:'YouTube',   cls:'p-yt', dot:'#FF0033'},
  {key:'TikTok',    cls:'p-tt', dot:'#00F2EA'},
  {key:'Blog',      cls:'p-bl', dot:'#0A8C5E'},
  {key:'Website',   cls:'p-web', dot:'#FF8A3D'},
];

/* ======= Nav Switching ======= */
const pages = {
  calendar: $('#pageCalendar'),
  profile: $('#pageProfile'),
  campaigns: $('#pageCampaigns'),
  analytics: $('#pageAnalytics'),
  settings: $('#pageSettings')
};
function showPage(name){
  Object.values(pages).forEach(p=>p.classList.remove('active'));
  pages[name]?.classList.add('active');
  // sidebar highlights
  $$('#nav a').forEach(a=>a.dataset.active = (a.dataset.page===name));
}
$('#nav').addEventListener('click',(e)=>{
  const a = e.target.closest('a'); if(!a) return;
  e.preventDefault();
  showPage(a.dataset.page);
});
$('#openSettings').addEventListener('click', ()=> showPage('settings'));

/* ======= Month + Calendar ======= */
let view = (()=>{const d=new Date(); return {y:d.getFullYear(), m:d.getMonth()}})();
const grid = $('#grid');
const monthLabel = $('#monthLabel');

function buildCalendar(y,m){
  grid.innerHTML='';
  const first = new Date(y,m,1);
  monthLabel.textContent = first.toLocaleString(undefined,{month:'long',year:'numeric'});

  const startDayRaw = first.getDay();
  const startDay = startDayRaw;
  const daysInMonth = new Date(y,m+1,0).getDate();
  const prevDays = new Date(y,m,0).getDate();
  const cells = 42;
  const todayISO = new Date().toISOString().slice(0,10);

  for(let i=0;i<cells;i++){
    const cell = document.createElement('div'); cell.className='day';
    let dayNum, iso, muted=false;
    if(i<startDay){ dayNum=prevDays-startDay+i+1; iso=isoOf(y,m-1,dayNum); muted=true; }
    else if(i>=startDay+daysInMonth){ dayNum=i-(startDay+daysInMonth)+1; iso=isoOf(y,m+1,dayNum); muted=true; }
    else { dayNum=i-startDay+1; iso=isoOf(y,m,dayNum); }
    if(iso===todayISO) cell.classList.add('selected');
    cell.dataset.iso = iso;

    const head=document.createElement('div'); head.className='dhead';
    const dnum=document.createElement('div'); dnum.className='dnum'; dnum.textContent = dayNum;
    const plus=document.createElement('button'); plus.className='plus'; plus.textContent='+';
    plus.title = 'Quick add';
    plus.onclick=(e)=>{ e.stopPropagation(); quickAdd(iso); };

    head.append(dnum, plus);

    const list=document.createElement('div');
    const items=(db[iso]||[]).filter(it => filters[it.platform??'']!==false);

    if(items.length===0) list.innerHTML='<div class="empty">No items</div>';
    else items.forEach(it=>{
      const card=document.createElement('div'); card.className='card';
      const cls = (PLATS.find(p=>p.key.toLowerCase()===(it.platform||'').toLowerCase())?.cls) || 'p-bl';
      const pip=document.createElement('div'); pip.className = `pip ${cls}`; pip.textContent = (it.platform||'P')[0]||'P';
      const title=document.createElement('div'); title.textContent = it.title||'Untitled';
      const time=document.createElement('div'); time.className='timechip'; time.textContent = it.time || '‚Äî';
      card.append(pip,title,time);
      list.append(card);
    });

    cell.append(head,list);
    grid.append(cell);
  }
}
function quickAdd(iso){
  const title = prompt('Title for this day?');
  if(!title) return;
  db[iso] ??= [];
  db[iso].push({platform:'Instagram', title, time:''});
  saveLS(DB_KEY, db);
  buildCalendar(view.y, view.m);
}

$('#prev').onclick=()=>{ view.m--; if(view.m<0){view.m=11;view.y--} buildCalendar(view.y,view.m) }
$('#next').onclick=()=>{ view.m++; if(view.m>11){view.m=0;view.y++} buildCalendar(view.y,view.m) }

/* ======= View-by (Eye) ======= */
const viewByBtn = $('#viewByBtn');
const viewByMenu = $('#viewByMenu');

function renderViewBy(){
  viewByMenu.innerHTML='';
  PLATS.forEach(p=>{
    const row = document.createElement('label'); row.className='drop-row';
    const chip = document.createElement('span'); chip.className='pill';
    const dot = document.createElement('span'); dot.className='dot'; dot.style.background=p.dot;
    chip.append(dot, document.createTextNode(' '+p.key));
    const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = filters[p.key]!==false;
    cb.style.marginLeft='auto';
    cb.addEventListener('change', ()=>{ filters[p.key]=cb.checked; saveLS(FILTERS_KEY, filters); buildCalendar(view.y, view.m); });
    row.append(chip, cb);
    viewByMenu.appendChild(row);
  });
}
viewByBtn.addEventListener('click', (e)=>{ e.stopPropagation(); viewByMenu.classList.toggle('open'); });
document.addEventListener('click', (e)=>{ if(!e.target.closest('#viewByMenu') && !e.target.closest('#viewByBtn')) viewByMenu.classList.remove('open'); });

/* ======= Profile Tab (mock-exact) ======= */
function yearOptions(){
  const sel = $('#pYear'); sel.innerHTML='';
  const now = new Date().getFullYear();
  for(let y=now; y>=1900; y--){
    const opt=document.createElement('option'); opt.value=String(y); opt.textContent=String(y);
    sel.append(opt);
  }
}

function loadProfileUI(){
  $('#pName').value = profile.name||'';
  $('#pIndustry').value = profile.industry||'';
  $('#pTone').value = profile.tone||'';
  $('#pYear').value = profile.year || String(new Date().getFullYear());
  $('#pMotto').value = profile.motto||'';
  $('#pBio').value = profile.bio||'';
  $('#pNotes').value = profile.notes||'';

  // links
  const wrap = $('#linkWrap'); wrap.innerHTML='';
  (profile.links||[]).forEach((v,i)=> addLinkInput(v));
  if((profile.links||[]).length===0) addLinkInput('');

  // logo preview
  const box = $('#pLogoBox'); box.style.backgroundImage = profile.logo ? `url(${profile.logo})` : 'none';
}
function addLinkInput(value=''){
  const wrap = $('#linkWrap');
  const row = document.createElement('div'); row.className='link-row';
  const inp = document.createElement('input'); inp.className='input'; inp.placeholder='https://'; inp.value=value;
  const del = document.createElement('button'); del.className='monthbtn'; del.textContent='Remove';
  del.onclick=()=>{ row.remove(); };
  row.append(inp, del);
  wrap.append(row);
}
$('#addLink').addEventListener('click', ()=> addLinkInput(''));

$('#pLogo').addEventListener('change',(e)=>{
  const f = e.target.files?.[0]; if(!f) return;
  const r = new FileReader();
  r.onload = ()=>{ $('#pLogoBox').style.backgroundImage = `url(${r.result})`; profile.logo = r.result; };
  r.readAsDataURL(f);
});
$('#profileSave').addEventListener('click', ()=>{
  const links = Array.from($('#linkWrap').querySelectorAll('input')).map(i=>i.value.trim()).filter(Boolean);
  profile = {
    name: $('#pName').value.trim(),
    industry: $('#pIndustry').value.trim(),
    tone: $('#pTone').value.trim(),
    year: $('#pYear').value,
    motto: $('#pMotto').value.trim(),
    bio: $('#pBio').value.trim(),
    notes: $('#pNotes').value.trim(),
    logo: profile.logo || null,
    links
  };
  saveLS(PROFILE_KEY, profile);
  const btn = $('#profileSave'); const prev = btn.textContent;
  btn.textContent='Saved ‚úì'; setTimeout(()=> btn.textContent=prev, 1200);
});

/* ======= Settings Theme ======= */
$$('input[name="theme"]').forEach(r=>{
  r.checked = (r.value===settings.theme);
  r.addEventListener('change', ()=>{
    settings.theme = r.value;
    document.documentElement.setAttribute('data-theme', settings.theme);
    saveLS(SETTINGS_KEY, settings);
  });
});
// map a column key to a comparable value
function campValue(c, key){
  switch(key){
    case 'name':      return (c.name||'').toLowerCase();
    case 'objective': return (c.objective||'').toLowerCase();
    case 'range':     return (c.start||'') + '|' + (c.end||'');       // sort by start then end
    case 'posts':     return Number(c.posts||0);
    case 'status':    return (c.status||'').toLowerCase();
    case 'platforms': return (c.platforms||[]).join(',').toLowerCase();
    case 'tone':      return (c.tone||'').toLowerCase();
    case 'notes':     return (c.notes||'').toLowerCase();
    default:          return '';
  }
}

function sortedCampaigns(){
  const {key, dir} = campSort;
  const list = [...campaigns];
  list.sort((a,b)=>{
    const av = campValue(a,key), bv = campValue(b,key);
    if (av < bv) return dir==='asc' ? -1 :  1;
    if (av > bv) return dir==='asc' ?  1 : -1;
    return 0;
  });
  return list;
}

function updateCampScheduled(){
  const el = document.getElementById('campScheduled');
  if (!el) return;
  el.textContent = `${campaigns.length} Scheduled`;
}

// flip arrows (via aria-sort)
function applyCampSortIndicators(){
  document.querySelectorAll('.campaign-table .camp-head .camp-col').forEach(h=>{
    h.removeAttribute('aria-sort');
  });
  const active = document.querySelector(`.campaign-table .camp-head .camp-col[data-key="${campSort.key}"]`);
  if (active) active.setAttribute('aria-sort', campSort.dir);
}

// dump rows into #campBody
function renderCampaignRows(){
  const body = document.getElementById('campBody');
  if (!body) return;
  body.innerHTML = '';

  const rows = sortedCampaigns();
  if (!rows.length) return;

  rows.forEach(c=>{
    const row = document.createElement('div');
    row.className = 'camp-row';
    row.innerHTML = `
      <div class="camp-col" data-key="name">${c.name||''}</div>
      <div class="camp-col" data-key="objective">${c.objective||''}</div>
      <div class="camp-col" data-key="range">${(c.start||'‚Äî')} ‚Äì ${(c.end||'‚Äî')}</div>
      <div class="camp-col" data-key="posts">${c.posts ?? '‚Äî'}</div>
      <div class="camp-col" data-key="status">${c.status||''}</div>
      <div class="camp-col" data-key="platforms">${(c.platforms||[]).join(', ')}</div>
      <div class="camp-col" data-key="tone">${c.tone||''}</div>
      <div class="camp-col" data-key="notes">${c.notes||''}</div>
    `;
    body.appendChild(row);
  });
}
function wireCampaignSortClicks(){
  document
    .querySelectorAll('.campaign-table .camp-head .camp-col')
    .forEach(h=>{
      const key = h.getAttribute('data-key');
      if (!key) return;
      h.classList.add('sortable');
      h.addEventListener('click', ()=>{
        if (campSort.key === key){
          campSort.dir = (campSort.dir === 'asc' ? 'desc' : 'asc');
        } else {
          campSort.key = key;
          campSort.dir = 'asc';
        }
        saveLS(CAMP_SORT_KEY, campSort);
        applyCampSortIndicators();
        renderCampaignRows();
      });
    });
}

/* ======= INIT ======= */
document.documentElement.setAttribute('data-theme', settings.theme||'day');
renderViewBy();
buildCalendar(view.y, view.m);
yearOptions();
loadProfileUI();
// default to Calendar page (as requested)

document.getElementById('btnNewCampaign')?.addEventListener('click', ()=>{
  alert('New Campaign ‚Äî modal coming soon');
});

// === Campaigns init on load (must be outside the click handler) ===
updateCampScheduled();
applyCampSortIndicators();
renderCampaignRows();
wireCampaignSortClicks();


showPage('calendar');
/* === Campaigns: column resizer (fills width; saves to localStorage) === */
(() => {
  const table = document.querySelector('.campaign-table');
  const head  = table?.querySelector('.camp-head');
  if (!table || !head) return;

  const STORAGE_KEY = 'campaigns.colwidths.v2';
  // map header data-key -> CSS var name
  const keyToVar = {
    name:'--c-name',
    objective:'--c-objective',
    range:'--c-range',
    posts:'--c-posts',
    status:'--c-status',
    platforms:'--c-platforms',
    tone:'--c-tone',
    notes:'--c-notes'
  };

  // 1) Restore any saved widths
  try {
    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    for (const [k, px] of Object.entries(saved)) {
      const v = keyToVar[k];
      if (v && px) table.style.setProperty(v, px + 'px');
    }
  } catch {}

  // 2) Drag logic
  let drag = null;
  head.querySelectorAll('.camp-col').forEach(col => {
    const key  = col.getAttribute('data-key');
    const grip = col.querySelector('.col-grip');
    if (!key || !grip || !keyToVar[key]) return;

    grip.addEventListener('mousedown', e => {
      e.preventDefault();
      const rect = col.getBoundingClientRect();
      const current =
        parseFloat(getComputedStyle(table).getPropertyValue(keyToVar[key])) || rect.width;
      drag = { key, startX: e.clientX, startW: current };
      document.body.style.cursor = 'col-resize';
    });
  });

  const onMove = e => {
    if (!drag) return;
    const w = Math.max(100, Math.round(drag.startW + (e.clientX - drag.startX)));
    table.style.setProperty(keyToVar[drag.key], w + 'px');
  };
  const onUp = () => {
    if (!drag) return;
    document.body.style.cursor = '';
    // collect current px values
    const out = {};
    for (const [k, v] of Object.entries(keyToVar)) {
      const val = parseFloat(getComputedStyle(table).getPropertyValue(v));
      if (val) out[k] = Math.round(val);
    }
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(out)); } catch {}
    drag = null;
  };

  window.addEventListener('mousemove', onMove);
  window.addEventListener('mouseup', onUp);
  window.addEventListener('mouseleave', onUp);
})();

</script>
</body>
</html>
