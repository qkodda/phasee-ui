<!doctype html>
<html lang="en" data-theme="orchid">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Phasee · Plan ahead. Stay ahead.</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <style>
  /* ===================== THEME & BASE ===================== */
  :root{
    --font: 13.5px/1.5 Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    --r-lg:14px; --r:10px; --r-sm:8px;
    --shadow-1: 0 5px 14px rgba(15,23,42,.06);
    --shadow-2: 0 12px 26px rgba(15,23,42,.10);
  }
  [data-theme="orchid"]{
    --bg-grad: radial-gradient(900px 480px at 20% -10%, #F1F3FF 0%, #ffffff 40%, #F7F8FF 100%);
    --surface:#ffffff; --surface-2:#F4F6FF; --ring:#E2E7FF;
    --ink:#0f172a; --muted:#6b7280;
    --accent:#6F6AE6; --accent-2:#8B7CFF;
    --chip:#EEF0FF; --chip-b:#DADFFF;
  }
  [data-theme="dark"]{
    --bg-grad: linear-gradient(180deg,#0b0d12,#0f1320);
    --surface:#121623; --surface-2:#0f1422; --ring:#1f2434;
    --ink:#e5e7eb; --muted:#9aa3b2;
    --accent:#7C5CFF; --accent-2:#5EC8FF;
    --chip:#172037; --chip-b:#283354;
  }

  *{box-sizing:border-box}
  html,body{margin:0;height:100%}
  body{font:var(--font); color:var(--ink); background:var(--bg-grad)}
  a{color:inherit; text-decoration:none}

  .btn{
    appearance:none; border:1px solid var(--ring); background:var(--surface); color:var(--ink);
    padding:6px 8px; border-radius:8px; font-weight:800; cursor:pointer; white-space:nowrap;
    transition:filter .15s, transform .04s, box-shadow .15s;
  }
  .btn:hover{filter:brightness(1.03)}
  .btn:active{transform:translateY(.4px)}
  .btn.primary{
    border-color:transparent; color:#fff;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    box-shadow:0 8px 20px color-mix(in oklab, var(--accent) 28%, transparent);
  }
  .btn.ghost{background:transparent}

  .badge{
    display:inline-flex; align-items:center; gap:6px; padding:3px 7px; border-radius:999px;
    background:var(--surface-2); border:1px solid var(--ring); font-weight:800; font-size:12px;
  }

  /* Shell */
  .app{display:grid; grid-template-columns:180px 1fr; min-height:100dvh}

  /* Sidebar */
  .side{
    position:sticky; top:0; height:100dvh; background:linear-gradient(180deg, var(--surface), var(--surface-2));
    border-right:1px solid var(--ring); padding:12px 10px; display:flex; flex-direction:column; gap:10px; z-index:5;
  }
  .brand{display:flex; align-items:center; gap:10px; font-weight:900; padding:6px 8px}
  .brandname{font-size:20px}

  .nav{display:grid; gap:6px; margin-top:8px}
  .nav a{
    display:flex; align-items:center; gap:10px; padding:8px; border-radius:10px; font-weight:800; border:1px solid transparent;
  }
  .nav a[data-active="true"], .nav a:hover{background:var(--surface-2); border-color:var(--ring)}
  .nav svg{opacity:.8}

  .side .foot{margin-top:auto; display:grid; gap:6px; padding:6px}
  .settings-link{font-weight:800; color:#3b3f77; cursor:pointer; width:max-content}
  [data-theme="dark"] .settings-link{color:#a7b4ff}
  .settings-link:hover{text-decoration:underline}
  .upgrade-link{font-weight:900; color:#6F6AE6}
  .upgrade-link:hover{text-decoration:underline}

  /* Main */
  .main{display:grid; grid-template-rows:56px 1fr}
  .top{
    background:linear-gradient(180deg, var(--surface), color-mix(in srgb, var(--surface-2) 60%, var(--surface) 40%));
    border-bottom:1px solid var(--ring); padding:0 12px;
    display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:4;
  }
  .title{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
  .month{font-weight:900; font-size:18px}
  .toolbar{display:flex; align-items:center; gap:10px; flex-wrap:wrap; position:relative}

  /* Content panels */
  .content{padding:10px; display:grid; gap:10px}
  .card{background:var(--surface); border:1px solid var(--ring); border-radius:12px; box-shadow:var(--shadow-1); padding:10px}
  .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}

  /* Calendar */
  .calendar{background:var(--surface); border:1px solid var(--ring); border-radius:10px; box-shadow:var(--shadow-2); padding:6px}
  .cal-head{display:flex; align-items:center; justify-content:space-between; padding:2px 6px 6px}
  .muted{color:var(--muted); font-size:12px}
  .weekdays{display:grid; grid-template-columns:repeat(7,1fr); gap:3px; padding:0 6px 4px; color:#8d97ae; font-weight:900; font-size:11px}
  .grid{display:grid; grid-template-columns:repeat(7,1fr); gap:3px}
  .day{
    background:var(--surface); border:1px solid var(--ring); border-radius:10px; padding:6px; min-height:84px;
    display:grid; grid-template-rows:auto 1fr; gap:4px; position:relative; box-shadow:var(--shadow-1);
    transition:transform .08s ease, box-shadow .15s ease;
  }
  .day:hover{transform:translateY(-1px); box-shadow:0 12px 26px rgba(15, 23, 42, .10)}
  .day.muted{opacity:.9}
  .day.today{outline:2px solid color-mix(in oklab, var(--accent) 28%, transparent); outline-offset:2px}
  .dhead{display:flex; align-items:center; justify-content:space-between}
  .dnum{font-weight:900; font-size:11px; display:flex; align-items:center; gap:6px}
  .plus{
    position:absolute; top:6px; right:6px; width:22px; height:22px; border-radius:8px; border:0; color:#fff; cursor:pointer; font-weight:900; font-size:14px;
    background:linear-gradient(135deg,var(--accent),var(--accent-2)); box-shadow:0 10px 20px color-mix(in oklab, var(--accent) 32%, transparent);
  }
  .list{display:grid; gap:4px}
  .empty{opacity:.65; color:#97a0b3; font-size:11px}
  .cal-card{
    display:flex; align-items:center; gap:6px; padding:6px 8px; border-radius:10px; border:1px solid rgba(0,0,0,.05); box-shadow:0 6px 14px rgba(15,23,42,.08);
  }
  .cal-card .pip{width:20px; height:20px; border-radius:7px; display:grid; place-items:center; color:#1d2435; font-size:12px; font-weight:900}
  .timechip{margin-left:auto; font-weight:900; padding:2px 7px; border-radius:999px; background:rgba(255,255,255,.9); border:1px solid rgba(0,0,0,.05); font-size:10px}
  .ig{background:#FFEFF7; border-color:#FFD9EC} .ig .pip{background:#FFB7DA}
  .fb{background:#EDF2FF; border-color:#DDE6FF} .fb .pip{background:#BFD0FF}
  .x {background:#EEF1F7; border-color:#DDE3F1} .x  .pip{background:#CFD7E7}
  .yt{background:#FFE9EC; border-color:#FFD5DB} .yt .pip{background:#FFB8C0}
  .tt{background:#FFF4D2; border-color:#FFE8AA} .tt .pip{background:#FFD57A}
  .blog{background:#E9F9F0; border-color:#D3F0E2} .blog .pip{background:#BFE9CF}
  .pin{background:#FFE4EA; border-color:#FFC9D6} .pin .pip{background:#FF9EB5}
  .li{background:#E8F3FF; border-color:#D3E7FF} .li .pip{background:#A9D0FF}

  /* Dropdown (eye/View by) */
  .iconbtn{appearance:none; border:1px solid var(--ring); background:var(--surface); border-radius:10px; padding:6px 8px; cursor:pointer; font-weight:800}
  .eye{display:inline-flex; align-items:center; gap:6px}
  .dropdown{
    position:absolute; right:0; top:36px; min-width:240px; background:var(--surface); border:1px solid var(--ring);
    border-radius:12px; box-shadow:var(--shadow-2); padding:10px; display:none; z-index:10;
  }
  .dropdown.open{display:block}
  .drop-row{display:flex; align-items:center; gap:8px; padding:6px 4px; border-radius:8px}
  .drop-row:hover{background:var(--surface-2)}
  .ico-pill{width:22px;height:22px;border-radius:7px;display:grid;place-items:center;font-size:12px;font-weight:900}

  /* Sections visibility */
  .page{display:none}
  .page.active{display:block}

  /* Tables/simple lists */
  .table{width:100%; border-collapse:separate; border-spacing:0 8px; font-size:13px}
  .th{color:var(--muted); font-weight:900; padding:6px 8px}
  .tr{background:var(--surface); border:1px solid var(--ring); border-radius:10px; box-shadow:var(--shadow-1)}
  .td{padding:10px}

  /* Forms */
  .form-grid{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  label{font-weight:800; font-size:12px}
  .input, select, textarea{
    width:100%; padding:8px 10px; border:1px solid var(--ring); border-radius:10px; background:var(--surface); color:var(--ink); outline:none;
  }
  .input:focus, select:focus, textarea:focus{border-color:color-mix(in oklab, var(--accent) 35%, #cbd5ff); background:var(--surface-2)}

  /* Compact tweaks already applied above */

  @media (max-width:980px){
    .app{grid-template-columns:78px 1fr}
    .brandname{display:none}
    .form-grid{grid-template-columns:1fr}
  }
  </style>
</head>

<body>
<div class="app">
  <!-- SIDEBAR -->
  <aside class="side">
    <div class="brand">
      <div class="brandname">Phasee</div>
    </div>

    <nav class="nav" id="nav">
      <a href="#/calendar" data-route="calendar" data-active="true">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M7 2h2v3H7V2m8 0h2v3h-2V2M5 7h14v13H5V7m2 4h4v4H7v-4z"/></svg>
        Calendar
      </a>
      <a href="#/profile" data-route="profile">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5m0 2c-5 0-9 2.5-9 5v1h18v-1c0-2.5-4-5-9-5z"/></svg>
        Profile
      </a>
      <a href="#/campaigns" data-route="campaigns">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M3 4h18v3H3V4m0 5h18v3H3V9m0 5h18v3H3v-3z"/></svg>
        Campaigns
      </a>
      <a href="#/analytics" data-route="analytics">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M3 17h18v2H3v-2m2-2l4-5 3 4 5-7 4 6v2H5z"/></svg>
        Analytics
      </a>
      <a href="#/settings" data-route="settings">
        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M12 8a4 4 0 1 0 4 4a4 4 0 0 0-4-4m8.94 3.34l-1.25-.22a6.91 6.91 0 0 0-1-2.41l.75-1.03a.5.5 0 0 0-.04-.64l-1.41-1.41a.5.5 0 0 0-.64-.04l-1.03.75a6.91 6.91 0 0 0-2.41-1l-.22-1.25A.5.5 0 0 0 10.5 3h-2a.5.5 0 0 0-.49.41L7.82 4.66a6.91 6.91 0 0 0-2.41 1l-1.03-.75a.5.5 0 0 0-.64.04L2.33 6.36a.5.5 0 0 0-.04.64l.75 1.03a6.91 6.91 0 0 0-1 2.41l-1.25.22A.5.5 0 0 0 0 12.5v2a.5.5 0 0 0 .41.49l1.25.22a6.91 6.91 0 0 0 1 2.41l-.75 1.03a.5.5 0 0 0 .04.64l1.41 1.41a.5.5 0 0 0 .64.04l1.03-.75a6.91 6.91 0 0 0 2.41 1l.22 1.25a.5.5 0 0 0 .49.41h2a.5.5 0 0 0 .49-.41l.22-1.25a6.91 6.91 0 0 0 2.41-1l1.03.75a.5.5 0 0 0 .64-.04l1.41-1.41a.5.5 0 0 0 .04-.64l-.75-1.03a6.91 6.91 0 0 0 1-2.41l1.25-.22a.5.5 0 0 0 .41-.49v-2a.5.5 0 0 0-.41-.49Z"/></svg>
        Settings
      </a>
    </nav>

    <div class="foot">
      <div class="note">Phasee Core Subscription</div>
      <a class="upgrade-link" href="#">Upgrade Plan</a>
    </div>
  </aside>

  <!-- MAIN -->
  <section class="main">
    <header class="top">
      <div class="title">
        <button class="btn" id="prev" title="Previous">‹</button>
        <div class="month" id="monthLabel">—</div>
        <button class="btn" id="next" title="Next">›</button>
      </div>
      <div class="toolbar">
        <div class="muted" id="schedCount">0 scheduled</div>
        <button class="iconbtn eye" id="viewByBtn" title="View by">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M12 6c-5 0-9 6-9 6s4 6 9 6 9-6 9-6-4-6-9-6m0 10a4 4 0 1 1 4-4 4 4 0 0 1-4 4z"/></svg>
        </button>
        <div class="dropdown" id="viewByMenu"></div>
        <button class="btn">Acme Co</button>
      </div>
    </header>

    <!-- CALENDAR PAGE -->
    <div class="content page active" id="page-calendar">
      <div class="calendar">
        <div class="cal-head">
          <div class="muted" id="rangeText">—</div>
        </div>
        <div class="weekdays"><div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div></div>
        <div class="grid" id="grid"></div>
      </div>
    </div>

    <!-- PROFILE PAGE -->
    <div class="content page" id="page-profile">
      <div class="card">
        <h3>Profile</h3>
        <div class="form-grid">
          <div>
            <label>Company / Brand</label>
            <input id="pName" class="input" placeholder="e.g., Acme Co">
          </div>
          <div>
            <label>Industry</label>
            <input id="pIndustry" class="input" placeholder="e.g., DTC skincare">
          </div>
          <div>
            <label>Founded (Year)</label>
            <select id="pYear" class="input"></select>
          </div>
          <div>
            <label>Tone / Culture</label>
            <input id="pTone" class="input" placeholder="e.g., Playful, Bold">
          </div>
          <div>
            <label>Logo / Image</label>
            <input id="pLogo" class="input" type="file" accept="image/*">
          </div>
          <div>
            <label>Preview</label>
            <img id="pLogoPrev" alt="" style="max-width:160px; border-radius:10px; display:none; border:1px solid var(--ring)">
          </div>
          <div style="grid-column:1 / -1">
            <label>Additional Information</label>
            <textarea id="pNotes" class="input" rows="3" placeholder="Anything that helps us build better prompts & comps"></textarea>
          </div>
        </div>
        <div class="row" style="justify-content:flex-end">
          <button class="btn primary" id="profileSave">Save</button>
        </div>
      </div>
    </div>

    <!-- CAMPAIGNS PAGE -->
    <div class="content page" id="page-campaigns">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <h3>Campaigns</h3>
          <div class="row">
            <label class="muted">Sort:</label>
            <select id="campSort" class="input">
              <option value="date">Date</option>
              <option value="platform">Platform</option>
              <option value="title">Title</option>
            </select>
            <button class="btn primary" id="newCampaign">+ New Campaign</button>
          </div>
        </div>

        <table class="table" id="campTable">
          <thead>
            <tr class="th">
              <td class="th">Date</td>
              <td class="th">Title</td>
              <td class="th">Platforms</td>
              <td class="th">Owner</td>
              <td class="th">Status</td>
              <td class="th">Actions</td>
            </tr>
          </thead>
          <tbody id="campTbody"></tbody>
        </table>
      </div>
    </div>

    <!-- ANALYTICS PAGE -->
    <div class="content page" id="page-analytics">
      <div class="row" style="align-items:stretch">
        <div class="card" style="flex:1">
          <h3>Industry</h3>
          <select id="anaIndustry" class="input" style="max-width:320px">
            <option value="general">General</option>
            <option value="beauty">Beauty</option>
            <option value="fitness">Fitness</option>
            <option value="fashion">Fashion</option>
            <option value="tech">Tech</option>
            <option value="food">Food & Beverage</option>
            <option value="gaming">Gaming</option>
            <option value="finance">Finance</option>
          </select>
          <div class="muted" style="margin-top:8px">Benchmarks (placeholder) update with industry.</div>
        </div>

        <div class="card" style="flex:1">
          <h3>Competitors (Goals)</h3>
          <div class="row" style="flex-direction:column; gap:8px">
            <input class="input" id="comp1" placeholder="Competitor / Handle #1">
            <input class="input" id="comp2" placeholder="Competitor / Handle #2">
            <button class="btn" id="addComp">+ Add More</button>
            <div id="compMore" class="row" style="flex-direction:column; gap:8px"></div>
          </div>
          <div class="muted" style="margin-top:8px">Use this to compare cadence & performance over time.</div>
        </div>

        <div class="card" style="flex:1">
          <h3>Personal</h3>
          <div class="row" style="gap:20px">
            <div>
              <div class="muted">Scheduled this month</div>
              <div id="kpiUpcoming" style="font-weight:900; font-size:26px">0</div>
            </div>
            <div>
              <div class="muted">Top Platform</div>
              <div id="kpiTopPlat" style="font-weight:900; font-size:26px">—</div>
            </div>
          </div>
          <div class="muted" style="margin-top:8px">Filter</div>
          <div id="anaFilter" class="row" style="gap:6px; margin-top:6px"></div>
        </div>
      </div>
    </div>

    <!-- SETTINGS PAGE -->
    <div class="content page" id="page-settings">
      <div class="row" style="align-items:stretch">
        <div class="card" style="flex:1.6">
          <h3>Settings</h3>
          <div class="row" style="gap:16px; margin-bottom:8px">
            <div>
              <div class="muted">Theme</div>
              <label><input type="radio" name="theme" value="orchid" checked> Day</label>
              <label style="margin-left:8px"><input type="radio" name="theme" value="dark"> Night</label>
            </div>
          </div>

          <div style="margin-top:8px">
            <h4>Integrations</h4>
            <div class="muted">Connect social platforms for login & scheduling.</div>
            <div class="row" style="margin-top:8px; gap:8px; flex-wrap:wrap">
              <button class="btn" data-oauth="instagram">Connect Instagram</button>
              <button class="btn" data-oauth="tiktok">Connect TikTok</button>
              <button class="btn" data-oauth="facebook">Connect Facebook</button>
              <button class="btn" data-oauth="pinterest">Connect Pinterest</button>
              <button class="btn" data-oauth="twitter">Connect X/Twitter</button>
              <button class="btn" data-oauth="linkedin">Connect LinkedIn</button>
            </div>
          </div>
        </div>

        <div class="card" style="flex:1">
          <h3>Account</h3>
          <div class="muted">Billing info, plan, profile, and organization settings.</div>
          <div class="row" style="margin-top:8px">
            <button class="btn">Manage Account</button>
            <button class="btn">Change Plan</button>
          </div>

          <h4 style="margin-top:14px">Auth</h4>
          <div class="row">
            <button class="btn primary" id="loginBtn">Log in</button>
            <button class="btn" id="logoutBtn">Log out</button>
          </div>
        </div>
      </div>
    </div>

  </section>
</div>

<script>
/* ===================== CONFIG ===================== */
/** Change this to your API (Railway) origin, e.g. https://phasee-brain-production.up.railway.app */
const API_BASE = (window.PHASEE_API_BASE || "https://phasee-brain-production.up.railway.app").replace(/\/+$/,'');

/* ===================== Helpers ===================== */
const $  = (sel, root=document) => root.querySelector(sel);
const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
const esc = s=> (s||'').replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
function save(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
function load(k,fallback){ try{ const v=localStorage.getItem(k); return v?JSON.parse(v):fallback }catch{ return fallback } }
function isoOf(y,m,d){ return new Date(y,m,d).toISOString().slice(0,10); }

/* ===================== Routing ===================== */
const routes = ['calendar','profile','campaigns','analytics','settings'];
function showRoute(route){
  routes.forEach(r=>{
    $('#page-'+r).classList.toggle('active', r===route);
    $('#nav [data-route="'+r+'"]').dataset.active = (r===route)+'';
  });
  if(route==='analytics') refreshAnalytics();
}
function handleHash(){
  const r = (location.hash.replace(/^#\/?/,'')||'calendar').split('/')[0];
  if(!routes.includes(r)) return showRoute('calendar');
  showRoute(r);
}
window.addEventListener('hashchange', handleHash);

/* ===================== Calendar ===================== */
let settings = load('phasee-settings', { theme:'orchid' });
let filters = load('phasee-filters', { Instagram:true, TikTok:true, Facebook:true, Pinterest:true, X:true, LinkedIn:true, YouTube:true, Blog:true, Website:true });
let db = load('phasee-cal', {});   // simple local store for calendar items
let campaigns = load('phasee-camps', []);

const grid = $('#grid');
const monthLabel = $('#monthLabel');
const rangeText = $('#rangeText');
const schedCount = $('#schedCount');

function buildViewBy(){
  const menu = $('#viewByMenu'); menu.innerHTML='';
  const items = [
    {k:'Instagram', cls:'ig', label:'Instagram'},
    {k:'TikTok', cls:'tt', label:'TikTok'},
    {k:'Facebook', cls:'fb', label:'Facebook'},
    {k:'Pinterest', cls:'pin', label:'Pinterest'},
    {k:'X', cls:'x', label:'X / Twitter'},
    {k:'LinkedIn', cls:'li', label:'LinkedIn'},
    {k:'YouTube', cls:'yt', label:'YouTube'},
    {k:'Blog', cls:'blog', label:'Blog'},
  ];
  items.forEach(p=>{
    const row=document.createElement('label'); row.className='drop-row';
    const pill=document.createElement('div'); pill.className='ico-pill '+p.cls; pill.textContent=p.k[0];
    const cb=document.createElement('input'); cb.type='checkbox'; cb.checked = filters[p.k]!==false;
    cb.addEventListener('change', () => { filters[p.k]=cb.checked; save('phasee-filters',filters); buildCalendar(view.y,view.m); });
    const txt=document.createElement('span'); txt.textContent=' '+p.label;
    row.append(pill, cb, txt);
    menu.appendChild(row);
  });
}
$('#viewByBtn').addEventListener('click', (e)=>{ e.stopPropagation(); $('#viewByMenu').classList.toggle('open'); });
document.addEventListener('click', (e)=>{ if(!e.target.closest('#viewByMenu') && !e.target.closest('#viewByBtn')) $('#viewByMenu').classList.remove('open'); });

let view = (()=>{const d=new Date(); return {y:d.getFullYear(), m:d.getMonth()}})();

function buildCalendar(y,m){
  grid.innerHTML='';
  const first=new Date(y,m,1);
  const startDayRaw=first.getDay();
  const weekStart=0;
  const startDay = (startDayRaw - weekStart + 7) % 7;

  const daysInMonth=new Date(y,m+1,0).getDate();
  const prevDays=new Date(y,m,0).getDate();
  const cells=42;

  monthLabel.textContent = first.toLocaleString(undefined,{month:'long',year:'numeric'});
  rangeText.textContent = `${first.toLocaleDateString(undefined,{month:'short'})} 1–${daysInMonth}`;
  const todayISO = new Date().toISOString().slice(0,10);

  let visibleTotal=0;

  for(let i=0;i<cells;i++){
    const cell=document.createElement('div'); cell.className='day';
    let dayNum, iso, muted=false;
    if(i<startDay){ dayNum=prevDays-startDay+i+1; iso=isoOf(y,m-1,dayNum); muted=true; }
    else if(i>=startDay+daysInMonth){ dayNum=i-(startDay+daysInMonth)+1; iso=isoOf(y,m+1,dayNum); muted=true; }
    else { dayNum=i-startDay+1; iso=isoOf(y,m,dayNum); }
    if(muted) cell.classList.add('muted');
    if(iso===todayISO) cell.classList.add('today');
    cell.dataset.iso=iso;

    const head=document.createElement('div'); head.className='dhead';
    head.innerHTML=`<div class="dnum">${dayNum}</div>`;
    const plus=document.createElement('button'); plus.className='plus'; plus.textContent='+'; plus.onclick=(e)=>{ e.stopPropagation(); quickAdd(iso); };

    const list=document.createElement('div'); list.className='list';
    const items=(db[iso]||[]).filter(it => filters[it.platform??'']!==false);
    visibleTotal += items.length;

    if(items.length===0) list.innerHTML='<div class="empty">No items</div>';
    else items.forEach(it=>{
      const card=document.createElement('div'); card.className='cal-card '+(classOf(it.platform));
      card.innerHTML=`<div class="pip">${(it.platform||'P')[0]}</div><div>${esc(it.title||'Untitled')}</div><div class="timechip">${esc(it.time||'')}</div>`;
      list.appendChild(card);
    });

    cell.append(head, plus, list);
    grid.appendChild(cell);
  }

  schedCount.textContent = `${visibleTotal} scheduled`;
}

function classOf(platform){
  const map = {Instagram:'ig', TikTok:'tt', Facebook:'fb', Pinterest:'pin', X:'x', LinkedIn:'li', YouTube:'yt', Blog:'blog', Website:'web'};
  return map[platform]||'blog';
}

function quickAdd(iso){
  db[iso] ??= [];
  db[iso].push({ platform:'Instagram', title:'New Post', time:'' });
  save('phasee-cal', db);
  buildCalendar(view.y, view.m);
}

$('#prev').onclick=()=>{ view.m--; if(view.m<0){view.m=11;view.y--} buildCalendar(view.y,view.m) }
$('#next').onclick=()=>{ view.m++; if(view.m>11){view.m=0;view.y++} buildCalendar(view.y,view.m) }

/* ===================== Profile ===================== */
function fillYears(){
  const sel = $('#pYear'); sel.innerHTML='';
  const now=(new Date()).getFullYear();
  for(let y=now; y>=1900; y--){
    const opt=document.createElement('option'); opt.value=String(y); opt.textContent=String(y);
    sel.appendChild(opt);
  }
}
$('#pLogo').addEventListener('change', (e)=>{
  const f=e.target.files?.[0]; if(!f) return;
  const r=new FileReader(); r.onload=()=>{ $('#pLogoPrev').src=r.result; $('#pLogoPrev').style.display='block'; };
  r.readAsDataURL(f);
});
$('#profileSave').onclick=()=>{
  const prof = {
    name: $('#pName').value.trim(),
    industry: $('#pIndustry').value.trim(),
    founded: $('#pYear').value,
    tone: $('#pTone').value.trim(),
    notes: $('#pNotes').value.trim()
  };
  save('phasee-profile', prof);
  alert('Profile saved');
}

/* ===================== Campaigns ===================== */
function renderCampaigns(){
  const tb = $('#campTbody'); tb.innerHTML='';
  const rows = [...campaigns];
  const sort = $('#campSort').value;
  rows.sort((a,b)=>{
    if(sort==='date') return a.start.localeCompare(b.start);
    if(sort==='platform') return (a.plats?.[0]||'').localeCompare(b.plats?.[0]||'');
    return (a.title||'').localeCompare(b.title||'');
  });
  rows.forEach((c, idx)=>{
    const tr=document.createElement('tr'); tr.className='tr';
    tr.innerHTML=`
      <td class="td"><div class="muted">${esc(c.start)} → ${esc(c.end)}</div></td>
      <td class="td"><b>${esc(c.title||'Campaign')}</b></td>
      <td class="td">${(c.plats||[]).map(p=>`<span class="badge ${classOf(p)}"><b>${p[0]}</b> ${esc(p)}</span>`).join(' ')}</td>
      <td class="td">—</td>
      <td class="td">Draft</td>
      <td class="td">
        <button class="btn" data-edit="${idx}">Edit</button>
        <button class="btn" data-del="${idx}">Delete</button>
      </td>
    `;
    tb.appendChild(tr);
  });
  tb.addEventListener('click', (e)=>{
    const btn=e.target.closest('button'); if(!btn) return;
    if(btn.dataset.del){ campaigns.splice(Number(btn.dataset.del),1); save('phasee-camps',campaigns); renderCampaigns(); }
    if(btn.dataset.edit){ alert('Edit coming soon'); }
  }, {once:true});
}
$('#campSort').onchange=renderCampaigns;
$('#newCampaign').onclick=()=>{
  const today = new Date().toISOString().slice(0,10);
  campaigns.push({ title:'Campaign', start:today, end:today, plats:['Instagram','Facebook'] });
  save('phasee-camps', campaigns);
  renderCampaigns();
};

/* ===================== Analytics ===================== */
function refreshAnalytics(){
  // recompute from db (month window)
  const y=view.y, m=view.m, daysInMonth=new Date(y,m+1,0).getDate();
  const startISO=isoOf(y,m,1), endISO=isoOf(y,m,daysInMonth);
  let total=0; const platCount={};
  for(const k in db){
    if(k<startISO || k>endISO) continue;
    (db[k]||[]).forEach(it=>{
      if(filters[it.platform??'']===false) return;
      total++;
      const p=(it.platform||'Other'); platCount[p]=(platCount[p]||0)+1;
    });
  }
  $('#kpiUpcoming').textContent = total;
  const top = Object.entries(platCount).sort((a,b)=>b[1]-a[1])[0];
  $('#kpiTopPlat').textContent = top ? `${top[0]} (${top[1]})` : '—';

  // build quick filter chips
  const fwrap = $('#anaFilter'); fwrap.innerHTML='';
  ['Instagram','TikTok','Facebook','Pinterest','X','LinkedIn','YouTube','Blog'].forEach(p=>{
    const b=document.createElement('span'); b.className='badge '+classOf(p); b.textContent=p;
    fwrap.appendChild(b);
  });
}

/* ===================== Settings: Theme & OAuth ===================== */
function applyTheme(){
  document.documentElement.setAttribute('data-theme', settings.theme || 'orchid');
}
$$('input[name="theme"]').forEach(r=>{
  r.checked = (r.value === (settings.theme||'orchid'));
  r.addEventListener('change', ()=>{
    settings.theme = r.value;
    save('phasee-settings', settings);
    applyTheme();
  });
});

$('#loginBtn').onclick = async ()=>{
  try{
    // Optional: a central login endpoint (email/password or OAuth portal)
    location.href = `${API_BASE}/auth/login`;
  }catch(e){ alert('Login failed'); }
};
$('#logoutBtn').onclick = async ()=>{
  try{
    location.href = `${API_BASE}/auth/logout`;
  }catch(e){ alert('Logout failed'); }
};

// Provider buttons → /oauth/:provider/start
$('#page-settings').addEventListener('click', (e)=>{
  const b = e.target.closest('button[data-oauth]'); if(!b) return;
  const provider = b.getAttribute('data-oauth'); // instagram, tiktok, facebook, pinterest, twitter, linkedin
  location.href = `${API_BASE}/oauth/${provider}/start?return=${encodeURIComponent(location.href)}`;
});

/* ===================== Init ===================== */
function init(){
  applyTheme();
  buildViewBy();
  buildCalendar(view.y, view.m);
  renderCampaigns();
  fillYears();
  handleHash();
}
init();
</script>
</body>
</html>
